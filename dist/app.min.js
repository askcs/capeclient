/*!
 * CapeClient v1.0.0 (snapshot)
 * Ask Community Systems
 * Authors: Sven Stam, Cengiz Ulusoy
 * 06-05-2013 11:05
 */
"use strict";var ui={en:{meta:{name:"en",label:"English"},login:{header:"Please sign in",placeholder_username:"Please enter your username",placeholder_password:"Your password",label_rememberMe:"Remember Me",button_login:"Login",button_loggingIn:"Logging...",forgot_password:"forgot your password?",forgetPassword:"Forgot password",emailAddress:"Email address",resetPassword:"Reset Password",returnLogin:"return back to login",changePassword:"change password",downloadApp:"Download Mobile App",ph_username:"username",ph_newPass:"new  password",ph_retypePass:"retype password",alert_fillfiled:"Please fill all fields!",alert_wrongUserPass:"Wrong username or password!",loading_User:"Loading user information...",loading_Message:"Loading messages...",loading_Group:"Loading groups...",loading_Members:"Loading members...",loading_everything:"Everything loaded!",logout:"Logout",loading:"Loading.."},dashboard:{thisWeek:"This Week",welcome:"Welcome",newMessage:"New Messages",goToInbox:"Go to inbox",announcements:"Announcements",loadingPie:"Loading pie charts...",loadingP2000:"Loading alarm messages",noP2000:"There are no alarm messages"},planboard:{planboard:"Planboard",newAvail:"New Availability",day:"Day",week:"Week",month:"Month",updateAvail:"Update Availability",from:"From",till:"Till",state:"State",selectAState:"select a state",reoccuring:"Re-occuring",lessPeople:"There $v less people than needed!",samePeople:"There are just as many peopleas needed.",morePeople:"There are $v more people than needed!",wished:"Wished",combine_reoccuring:"This is a combined row of planning with re-occuring rows.",sendMsgToMember:"Send Message To Members",add:"Add",del:"Delete",change:"Change",setWish:"Set Wish",timeline:"Timeline",statistics:"Statistics",barCharts:"Bar charts",wishes:"Wishes",legenda:"Legenda",group:"Group",groups:"Groups",members:"Members",bothAvailable:"Both available",northAavailable:"available North",southAvailable:"available South",skipperOutService:"Skipper Of Service",notAvailable:"Not Available",notachieve:"Not Achieved",legendaLabels:{morePeople:"More people",enoughPeople:"Just enough people",lessPeople:"Less people"},lastSyncTime:"Last sync time:",dataRangeStart:"Data range start: ",DataRangeEnd:"Data range end: ",loadingTimeline:"Loading timeline...",addTimeSlot:"Adding a timeslot...",slotAdded:"New timeslot added successfully.",changingSlot:"Changing a timeslot...",slotChanged:"Timeslot changed successfully.",changingWish:"Changing wish value...",wishChanged:"Wish value changed successfully.",deletingTimeslot:"Deleting a timeslot...",timeslotDeleted:"Timeslot deleted successfully.",refreshTimeline:"Refreshing timeline...",preCompilingStortageMessage:"Pre-compiling shortage message",weeklyPlanning:"Weekly planning",planning:"Planning",minNumber:"Minimum number benodigden"},message:{messages:"Messages",composeAMessage:"Compose a message",compose:"Compose",inbox:"Inbox",outbox:"Outbox",trash:"Trash",composeMessage:"Compose message",close:"Close",broadcast:"Broadcast",sms:"SMS",email:"Email",receviers:"Recevier(s)",subject:"Subject",message:"Message",sendMessage:"Send Message",sender:"Sender",date:"Date",questionText:"Message",reply:"Reply",del:"Delete",noMessage:"There are no messages.",from:"From",newMsg:"New",deleteSelected:"Delete Selected Messages",someMessage:"There are $v message(s)",emptyTrash:"Empty Trash",noMsgInTrash:"There are no messages in trash.",box:"Box",persons:"Person(s)",restoreSelected:"Restore Selected Messages",loadingMessage:"Loading message...",escalation:"Escalation message",escalationBody:function(e,t,n,r,o){return"We have "+e+" shortage in between "+t+" "+n+" and "+r+" "+o+". "+"Would you please make yourself available if you are available for that period?"},removed:"Message removed successfully.",removing:"Removing the message...",refreshing:"Refreshing messages...",removingSelected:"Removing selected messages...",restoring:"Restoring the message back...",restored:"Message restored successfully.",restoringSelected:"Restoring selected messages...",emptying:"Emptying trash...",emptied:"Trash bin emptied successfully.",sending:"Sending the message...",sent:"Message sent.",typeSubject:"Type a subject",ph_filterMessage:"Filter messages..",noReceivers:"Please select a receiver."},groups:{groups:"Groups",newGroup:"New Group",newMember:"New Member",serach:"Search",addNewGroup:"Add New Group",editGroup:"Edit Group",searchResults:"Search results",group:"Group",close:"Close",name:"Name",saveGroup:"Save Group",registerMember:"Register Member",role:"Role",selectRole:"Select a role",selectGroup:"Choose a group",email:"Email",phone:"Phone",address:"Address",postCode:"Postcode",tel:"Tel",city:"City",userName:"Username",password:"Password",saveMember:"Save Member",serachFor:"Search results for ",sorryCanNotFind:"Sorry but we couldn't find what you are looking for.",addToGroup:"Add to group",addMemberToGroup:"Add Selected Members To Groups",resultCount:"There are $v results in your query.",deleteGroup:"Delete Group",noMembers:"There are no members.",removeSelectedMembers:"Remove Selected Members",memberCount:"There are $v member(s)",searchingMembers:"Searching members..",addingNewMember:"Adding a new member..",memberAdded:"Member added to group successfully.",refreshingGroupMember:"Refreshing groups and members list..",removingMember:"Removing member from group..",memberRemoved:"Member removed from group successfully.",removingSelected:"Removing selected members..",saving:"Saving group..",groupSaved:"Group saved successfully.",registerNew:"Registering a new member..",memberRegstered:"Member registered successfully.",deleting:"Deleting group..",deleted:"Group deleted successfully.",filterMembers:"Filter members..",searchfor:"firstname, lastname.."},profile:{profile:"Profile",edit:"Edit",password:"Password",timeline:"Timeline",profileView:"Profile View",userGroups:"User Groups",role:"Role",email:"Email",phone:"Phone",address:"Address",postcode:"Postcode",city:"City",editProfile:"Edit Profile",name:"Name",saveProfile:"Save Profile",passChange:"Password Change",currentPass:"Current password",newPass:"New password",newPassRepeat:"New password (Repeat)",changePass:"Change password",newAvail:"New Availability",refreshing:"Refreshing profile information..",dataChanged:"Profile data is succesfully changed.",pleaseFill:"Please fill all fields!",passNotMatch:"Provided passwords do not match! Please try it again.",changingPass:"Changing password..",passChanged:"Password is succesfully changed.",passwrong:"Given current password is wrong! Please try it again.",newTimeslotAdded:"New timeslot added successfully.",changingTimeslot:"Changing a timeslot..",timeslotChanged:"Timeslot is succesfully changed."},settings:{settings:"Settings",user:"User",application:"Application",userSettings:"User Settings",appSettings:"Application Settings",saveSettings:"Save Settings",langSetting:"Language",saving:"Saving settings...",refreshing:"Refreshing settings...",saved:"Settings successfully saved."},help:{header:"Help & Support",support:"Support"},downloads:{app:"Soon it will be downloadable.<br>",manual:"Download Manual"},loading:{general:"Loading",dashboard:"dashboard",planboard:"planboard",messages:"messages",groups:"groups",profile:"profile",settings:"settings"}},nl:{meta:{name:"nl",label:"Nederlands"},login:{header:"Inloggen",placeholder_username:"Vul uw gebruikersnaam in",placeholder_password:"Vul uw wachtwoord in",label_rememberMe:"Onthoud mij",button_login:"Login",button_loggingIn:"Inloggen...",forgot_password:"Wachtwoord vergeten?",forgetPassword:"Wachtwoord vergeten",emailAddress:"Email adres",resetPassword:"Wachtwoord opnieuw instellen",returnLogin:"Terugkeren om in te loggen",changePassword:"Wachtwoord wijzigen",downloadApp:"Download Mobiele App",ph_username:"gebruikersnaam",ph_newPass:"nieuw wachtwoord",ph_retypePass:"Typ wachtwoord",alert_fillfiled:"Vul alle velden in!",alert_wrongUserPass:"Onjuiste gebruikersnaam of wachtwoord!",loading_User:"Gebruikersinformatie laden...",loading_Message:"Berichten laden...",loading_Group:"Groepen laden...",loading_Members:"Leden laden...",loading_everything:"Alles is geladen!",logout:"Logout",loading:"Loading.."},dashboard:{thisWeek:"Deze week",welcome:"Welkom",newMessage:"Nieuwe berichten",goToInbox:"Ga naar inbox",loadingPie:"Cirkeldiagrammen laden...",announcements:"Alarm berichten",loadingP2000:"Alarm berichten laden...",noP2000:"Er zijn geen alarm berichten."},planboard:{planboard:"Planboard",newAvail:"Nieuwe beschikbaarheid",day:"Dag",week:"Week",month:"Maand",updateAvail:"Update beschikbaarheid",from:"Van",till:"Tot",state:"Status",selectAState:"selecteer een status",reoccuring:"Herhaling",lessPeople:"Er is een tekort van $v mens(en)!",samePeople:"Er zijn precies genoeg mensen.",morePeople:"Er is een overschot van $v mens(en)!",wished:"Gewenst",combine_reoccuring:"Dit is een gecombineerde planning.",sendMsgToMember:"Stuur bericht naar leden",add:"Toevoegen",del:"Verwijderen",change:"Wijzigen",setWish:"Behoefte instellen",timeline:"Tijdlijn",statistics:"Statistieken",barCharts:"Staafdiagrammen",wishes:"Behoefte",legenda:"Legenda",group:"Groep",groups:"Groepen",members:"Leden",bothAvailable:"Beiden beschikbaar",northAavailable:"Beschikbaar Noord",southAvailable:"Beschikbaar Zuid",skipperOutService:"Schipper van dienst",notAvailable:"Niet beschikbaar",notachieve:"Niet behaald",legendaLabels:{morePeople:"Meer mensen",enoughPeople:"Precies genoeg mensen",lessPeople:"Te weinig mensen"},lastSyncTime:"Laatste synchronisatietijd:",dataRangeStart:"Begin gegevensscala: ",DataRangeEnd:"Eind gegevensscala: ",loadingTimeline:"Tijdlijn laden...",addTimeSlot:"Tijdslot toevoegen...",slotAdded:"Tijdslot succesvol toegevoegd.",changingSlot:"Tijdslot wijzigen...",slotChanged:"Tijdslot succesvol gewijzigd.",changingWish:"Behoefte veranderen...",wishChanged:"Behoefte succesvol veranderd.",deletingTimeslot:"Tijdslot verwijderen...",timeslotDeleted:"Tijdslot succesvol verwijderd.",refreshTimeline:"Tijdlijn vernieuwen...",preCompilingStortageMessage:"Opstellen tekortbericht",weeklyPlanning:"Wekelijkse planning",planning:"Planning",minNumber:"Minimum aantal benodigde mensen"},message:{messages:"Berichten",composeAMessage:"Bericht opstellen",compose:"Opstellen",inbox:"Inbox",outbox:"Outbox",trash:"Prullenbak",composeMessage:"Bericht opstellen",close:"Sluiten",broadcast:"Extra medium",sms:"SMS",email:"Email",receviers:"Ontvanger(s)",subject:"Onderwerp",message:"Bericht",sendMessage:"Bericht versturen",sender:"Zender",date:"Datum",questionText:"Bericht",reply:"Antwoorden",del:"Verwijderen",noMessage:"Er zijn geen berichten.",from:"Van",newMsg:"Nieuw",deleteSelected:"Verwijder geselecteerde berichten",someMessage:"Er zijn $v berichten",emptyTrash:"Prullenbak legen",noMsgInTrash:"Er zijn geen berichten.",box:"Box",persons:"Personen",restoreSelected:"Geselecteerde berichten terugplaatsen",loadingMessage:"Bericht laden...",escalation:"Escalatiebericht",escalationBody:function(e,t,n,r,o){return"Er is een tekort van "+e+" mensen tussen "+t+" "+n+" en "+r+" "+o+". "+"Zet uzelf a.u.b. op beschikbaar indien u beschikbaar bent voor die periode"},removed:"Bericht succesvol verwijderd.",removing:"Bericht verwijderen...",refreshing:"Bericht vernieuwen...",removingSelected:"Geselecteerde berichten verwijderen...",restoring:"Bericht terugplaatsen...",restored:"Bericht succesvol teruggeplaatst.",restoringSelected:"Geselecteerde berichten terugplaatsen...",emptying:"Prullenbak leegmaken...",emptied:"Prullenbak succesvol geleegd.",sending:"Bericht versturen...",sent:"Bericht verstuurd.",typeSubject:"Vul een onderwerp in",ph_filterMessage:"Berichten filteren...",noReceivers:"Graag een ontvanger selecteren."},groups:{groups:"Groepen",newGroup:"Nieuwe Group",newMember:"Nieuw lid",serach:"Zoeken",addNewGroup:"Nieuwe groep toevoegen",editGroup:"Groep wijzigen",searchResults:"Zoekresultaten",group:"Groep",close:"Sluiten",name:"Naam",saveGroup:"Groep opslaan",registerMember:"Lid registreren",role:"Functie",selectRole:"Selecteer een functie",email:"Email",phone:"Telefoon",address:"Adres",postCode:"Postcode",tel:"Tel",city:"Stad",userName:"Gebruikersnaam",password:"Wachtwoord",saveMember:"Lid opslaan",serachFor:"Zoekresultaten voor ",sorryCanNotFind:"Sorry, geen resultaten.",addToGroup:"Aan groep toevoegen",addMemberToGroup:"Voeg geselecteerde leden aan groep toe",resultCount:"Er zijn $v resultaten.",deleteGroup:"Groep verwijderen",noMembers:"Er zijn geen leden.",removeSelectedMembers:"Geselecteerde leden verwijderen",memberCount:"Er zijn $v leden",searchingMembers:"Leden zoeken...",addingNewMember:"Nieuw lid toevoegen...",memberAdded:"Lid succesvol aan groep toegevoegd.",refreshingGroupMember:"Groepen- en ledenlijst vernieuwen...",removingMember:"Lid van groep verwijderen...",memberRemoved:"Lid succesvol van groep verwijderd.",removingSelected:"Geselecteerde leden verwijderen...",saving:"Groep opslaan...",groupSaved:"Groep succesvol opgeslagen.",registerNew:"Nieuw lid registreren...",memberRegstered:"Lid succesvol geregistreerd.",deleting:"Groep verwijderen...",deleted:"Groep succesvol verwijderd.",filterMembers:"Leden filteren...",searchfor:"voornaam, achternaam.."},profile:{profile:"Profiel",edit:"Wijzigen",password:"Wachtwoord",timeline:"Tijdlijn",profileView:"Profiel weergave",userGroups:"Gebruikersgroepen",role:"Functie",email:"Email",phone:"Telefoon",address:"Adres",postcode:"Postcode",city:"Stad",editProfile:"Profiel wijzigen",name:"Naam",saveProfile:"Profiel opslaan",passChange:"Wachtwoord wijzigen",currentPass:"Huidig wachtwoord",newPass:"Nieuw wachtwoord",newPassRepeat:"Herhaal nieuw wachtwoord",changePass:"Wachtwoord wijzigen",newAvail:"Nieuwe beschikbaarheid",refreshing:"Profielinformatie vernieuwen...",dataChanged:"Profielgegevens succesvol gewijzigd.",pleaseFill:"Vul a.u.b. alle velden in!",passNotMatch:"Ingevoerd wachtwoord komt niet overeen. Probeer het opnieuw.",changingPass:"Wachtwoord wijzigen...",passChanged:"Wachtwoord succesvol gewijzigd.",passwrong:"Ingevoerd wachtwoord is foutief! Probeer het opnieuw.",newTimeslotAdded:"Nieuw tijdslot succesvol toegevoegd.",changingTimeslot:"Tijdslot wijzigen...",timeslotChanged:"Tijdslot succesvol gewijzigd."},settings:{settings:"Instellingen",user:"Gebruiker",application:"Applicatie",userSettings:"Gebruikersinstellingen",appSettings:"Applicatie-instellingen",saveSettings:"Instellingen Opslaan",langSetting:"Taal",saving:"Instellingen wijzigen...",refreshing:"Instellingen vernieuwen...",saved:"Instellingen succesvol gewijzigd."},help:{header:"Hulp & Ondersteuning",support:"Ondersteuning"},downloads:{app:"Binnenkort te downloaden.",manual:"Download Handleiding"},loading:{general:"Laden",dashboard:"dashboard",planboard:"planboard",messages:"berichten",groups:"groepen",profile:"profiel",settings:"instellingen"}}};angular.module("CapeClient",["ngResource","CapeClient.Modals.Cape","CapeClient.Modals.User","CapeClient.Modals.Dashboard","CapeClient.Modals.Slots","CapeClient.Modals.Messages","CapeClient.Modals.Groups","CapeClient.Modals.Profile","CapeClient.Modals.Settings","CapeClient.Controllers.Login","CapeClient.Controllers.Planboard","CapeClient.Controllers.Timeline","CapeClient.Controllers.Timeline.Navigation","CapeClient.Services.Timer","CapeClient.Services.Session","CapeClient.Services.Dater","CapeClient.Services.EventBus","CapeClient.Services.Interceptor","CapeClient.Services.MD5","CapeClient.Services.Storage","CapeClient.Services.Strings","CapeClient.Services.Announcer","CapeClient.Services.Sloter","CapeClient.Services.Stats","$strap.directives","CapeClient.Filters"]),"localStorage"in window&&null!==window.localStorage&&basket.require({url:"libs/chosen/chosen.jquery.min.js"},{url:"libs/chaps/timeline/2.4.0/timeline_modified.min.js"},{url:"libs/bootstrap-datepicker/bootstrap-datepicker.min.js"},{url:"libs/bootstrap-timepicker/bootstrap-timepicker.min.js"},{url:"libs/daterangepicker/1.1.0/daterangepicker.min.js"},{url:"libs/sugar/1.3.7/sugar.min.js"},{url:"libs/raphael/2.1.0/raphael-min.js"}).then(function(){basket.require({url:"libs/g-raphael/0.5.1/g.raphael-min.js"},{url:"libs/g-raphael/0.5.1/g.pie-min.js"}).then(function(){})}),angular.module("CapeClient").value("$config",{title:"CapeClient",version:"1.0.0",lang:"nl",fullscreen:!0,profile:{meta:profile.meta,title:profile.title},statesall:{"com.ask-cs.State.Available":{className:"state-available",label:"Beschikbaar",color:"#4f824f",type:"Beschikbaar"},"com.ask-cs.State.KNRM.BeschikbaarNoord":{className:"state-available-north",label:"Beschikbaar voor Noord",color:"#000",type:"Beschikbaar"},"com.ask-cs.State.KNRM.BeschikbaarZuid":{className:"state-available-south",label:"Beschikbaar voor Zuid",color:"#e08a0c",type:"Beschikbaar"},"com.ask-cs.State.Unavailable":{className:"state-unavailable",label:"Niet Beschikbaar",color:"#a93232",type:"Niet Beschikbaar"},"com.ask-cs.State.KNRM.SchipperVanDienst":{className:"state-schipper-service",label:"Schipper van Dienst",color:"#e0c100",type:"Beschikbaar"},"com.ask-cs.State.Unreached":{className:"state-unreached",label:"Niet Bereikt",color:"#65619b",type:"Niet Beschikbaar"}},host:"http://openid.ask-cs.com:5280/http-bind",formats:{date:"dd-MM-yyyy",time:"HH:mm",datetime:"dd-MM-yyyy HH:mm",datetimefull:"dd-MM-yyyy HH:mm"},roles:profile.roles,timeline:{options:{axisOnTop:!0,width:"100%",height:"auto",selectable:!0,editable:!0,style:"box",groupsWidth:"150px",eventMarginAxis:0,showCustomTime:!0,groupsChangeable:!1,showNavigation:!1,intervalMin:36e5},config:{zoom:"0.4",bar:!1,wishes:!1,legenda:{},legendarer:!1,states:{},divisions:profile.divisions,densities:{less:"#a0a0a0",even:"#ba6a24",one:"#415e6b",two:"#3d5865",three:"#344c58",four:"#2f4550",five:"#2c424c",six:"#253943",more:"#486877"}}},pie:{colors:["#415e6b","#ba6a24","#a0a0a0"]},defaults:{settingsWebPaige:{user:{language:"nl"},app:{widgets:{groups:{}}}}},cookie:{expiry:30,path:"/"},init:function(){var e=this;angular.forEach(profile.states,function(t){e.timeline.config.states[t]=e.statesall[t]})}}),angular.module("CapeClient").config(["$locationProvider","$routeProvider","$httpProvider",function(e,t){t.when("/login",{templateUrl:"js/views/login.html",controller:"login"}).when("/planboard",{templateUrl:"js/views/planboard.html",controller:"planboard"}).otherwise({redirectTo:"/login"})}]),angular.module("CapeClient").run(["$rootScope","$location","$timeout","Session","Dater","Storage","$config","$window","Timer","Cape",function(e,t,n,r,o,a,i,s,l,u){e.config=i,e.connected=u.isConnected(),e.login=function(n){$("#login button[type=submit]").text("Login..").attr("disabled","disabled"),u.login(n.name,n.password,function(){e.connected=u.isConnected(),e.$apply(function(){t.path("/planboard")})})},e.logout=function(){e.connected=!1,u.disconnect(function(){t.path("/login")})},e.location=t.path(),e.$on("$routeChangeStart",function(){}),e.$on("$routeChangeSuccess",function(){e.location=t.path()}),e.$on("$routeChangeError",function(t,n,r,o){e.notifier.error(o)}),e.config=i,e.config.init(),e.browser=$.browser,angular.extend(e.browser,{screen:s.screen}),e.browser.ios?angular.extend(e.browser,{landscape:90==Math.abs(s.orientation)?!0:!1,portrait:90!=Math.abs(s.orientation)?!0:!1}):angular.extend(e.browser,{landscape:90!=Math.abs(s.orientation)?!0:!1,portrait:90==Math.abs(s.orientation)?!0:!1}),s.onresize=function(){e.browser.screen=s.screen},s.onorientationchange=function(){e.$apply(function(){e.browser.ios?angular.extend(e.browser,{landscape:90==Math.abs(s.orientation)?!0:!1,portrait:90!=Math.abs(s.orientation)?!0:!1}):angular.extend(e.browser,{landscape:90!=Math.abs(s.orientation)?!0:!1,portrait:90==Math.abs(s.orientation)?!0:!1})})},e.changeLanguage=function(t){e.ui=ui[t]},e.ui=ui[e.config.lang],a.get("periods")||o.registerPeriods(),e.app=e.app||{},e.statusBar={init:function(){e.loading={status:!1,message:"Loading.."}},display:function(t){e.loading={status:!0,message:t}},off:function(){e.loading.status=!1}},e.statusBar.init(),e.notifier={init:function(t,n,r){e.browser.mobile&&t===!0?s.alert(r):e.notification={status:t,type:n,message:r}},success:function(e,t){this.init(!0,"alert-success",e),t||this.destroy()},error:function(e,t){this.init(!0,"alert-danger",e),t||this.destroy()},destroy:function(){setTimeout(function(){e.notification.status=!1},5e3)}},e.notifier.init(!1,"",""),e.fixStyles=function(){($.os.mac||$.os.linux)&&$(".nav-tabs-app li a span").css({paddingTop:"10px",marginBottom:"0px"})},e.fullScreen=function(){screenfull.toggle($("html")[0])},$.os.windows&&(console.log("coming to here"),$("#loading p").css({paddingTop:"130px"}))}]),angular.module("CapeClient.Modals.User",["ngResource"]).factory("User",["$resource","$config","$q","$location","Storage","$rootScope",function(e,t,n,r,o){var a=e(),i=e(t.host+"/login",{},{process:{method:"GET",params:{uuid:"",pass:""}}}),s=e(t.host+"/logout",{},{process:{method:"GET",params:{}}}),l=e(t.host+"/resources",{},{get:{method:"GET",params:{}}}),u=e(t.host+"/passwordReset",{},{password:{method:"GET",params:{uuid:"",path:""}}});return a.prototype.password=function(e){var t=n.defer();return u.password({uuid:e.toLowerCase(),path:r.absUrl()},function(e){angular.equals(e,[])?t.resolve("ok"):t.resolve(e)},function(e){t.resolve(e)}),t.promise},a.prototype.login=function(e,t){var r=n.defer();return i.process({uuid:e,pass:t},function(e){angular.equals(e,[])?r.reject("Something went wrong with login!"):r.resolve(e)},function(e){r.resolve(e)}),r.promise},a.prototype.changePass=function(){var e=n.defer();return changePassword.get(function(t){e.resolve(t)},function(t){e.resolve(t)}),e.promise},a.prototype.logout=function(){var e=n.defer();return s.process(null,function(t){e.resolve(t)},function(t){e.resolve({error:t})}),e.promise},a.prototype.resources=function(){var e=n.defer();return l.get(null,function(t){angular.equals(t,[])?e.reject("User has no resources!"):(o.add("resources",angular.toJson(t)),e.resolve(t))},function(t){e.resolve({error:t})}),e.promise},new a}]),angular.module("CapeClient.Modals.Dashboard",["ngResource"]).factory("Dashboard",["$rootScope","$resource","$config","$q","Storage","Slots","Dater","Announcer",function(e,t,n,r,o,a,i,s){var l=t("http://knrm.myask.me/rpc/client/p2000.php",{},{p2000:{method:"GET",params:{},isArray:!0}});return l.prototype.pies=function(){var t=r.defer(),n=angular.fromJson(o.get("groups")),i=o.local.settings().app.widgets.groups,s=[],l=((new Date.now).getTime(),[]);return 0===i.length&&console.warn("no settings"),angular.forEach(n,function(e){i[e.uuid]&&s.push({id:e.uuid,name:e.name})}),angular.forEach(s,function(e){l.push(a.pie({id:e.id,name:e.name}))}),r.all(l).then(function(n){e.statusBar.off(),t.resolve(n)}),t.promise},l.prototype.p2000=function(){var e=r.defer();return $.ajax({url:n.profile.p2000.url+"?code="+n.profile.p2000.codes,dataType:"jsonp",success:function(t){e.resolve(s.process(t))},error:function(){e.resolve({error:error})}}),e.promise},new l}]),angular.module("CapeClient.Modals.Slots",["ngResource"]).factory("Slots",["$rootScope","$config","$resource","$q","Storage","Dater","Sloter","Stats",function(e,t,n,r,o,a,i,s){function l(e){var t=angular.fromJson(e.content);return{start:new Date(e.start).getTime()/1e3,end:new Date(e.end).getTime()/1e3,recursive:t.recursive,text:t.state,id:t.id}}var u=n(t.host+"/askatars/:user/slots",{user:""},{query:{method:"GET",params:{start:"",end:""},isArray:!0},change:{method:"PUT",params:{start:"",end:"",text:"",recursive:""}},save:{method:"POST",params:{}},remove:{method:"DELETE",params:{}}}),d=n(t.host+"/calc_planning/:id",{},{query:{method:"GET",params:{id:"",start:"",end:""},isArray:!0}}),c=n(t.host+"/network/:id/wish",{},{query:{method:"GET",params:{id:"",start:"",end:""},isArray:!0},save:{method:"PUT",params:{id:""}}});return u.prototype.wishes=function(e){var t=r.defer(),n={id:e.id,start:e.start,end:e.end};return c.query(n,function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},u.prototype.setWish=function(e){var t=r.defer(),n={start:e.start,end:e.end,wish:e.wish,recurring:e.recursive};return c.save({id:e.id},n,function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},u.prototype.aggs=function(e){var t=r.defer(),n={id:e.id,start:e.start,end:e.end};return void 0!=e.division&&(n.stateGroup=e.division),d.query(n,function(r){var o=s.aggs(r);u.prototype.wishes(n).then(function(n){t.resolve({id:e.id,division:e.division,wishes:n,data:r,ratios:o.ratios,durations:o.durations})})},function(e){t.resolve({error:e})}),t.promise},u.prototype.pie=function(e){var n=r.defer(),o=Math.floor(Date.now().getTime()/1e3),i=a.getPeriods(),l=a.current.week(),u={current:{period:i.weeks[l],data:[],shortages:[]},next:{period:i.weeks[l+1],data:[],shortages:[]}},c=u.current.period.last.timeStamp;return d.query({id:e.id,start:u.current.period.first.timeStamp/1e3,end:u.next.period.last.timeStamp/1e3},function(r){var a;if(r.length>1){angular.forEach(r,function(e){o>=e.start&&e.end>=o&&(a=e),1e3*e.start>=c?u.next.data.push(e):c>=1e3*e.start&&u.current.data.push(e)});var i=u.current.data[u.current.data.length-1],l=(u.next.data[0],(1e3*i.end-c)/1e3),d=[];u.current.data[0].start=u.current.period.first.timeStamp/1e3,l>0&&(i.end=c/1e3,u.next.data.unshift({diff:i.diff,start:c/1e3,end:i.end,wish:i.wish})),angular.forEach(u.current.data,function(e){e.end-e.start>0&&d.push(e),0>e.diff&&u.current.shortages.push(e)}),d[0].start=u.current.period.first.timeStamp/1e3,angular.forEach(u.next.data,function(e){0>e.diff&&u.next.shortages.push(e)}),n.resolve({id:e.id,name:e.name,weeks:{current:{data:d,state:a,shortages:u.current.shortages,start:{date:new Date(u.current.period.first.timeStamp).toString(t.formats.date),timeStamp:u.current.period.first.timeStamp},end:{date:new Date(u.current.period.last.timeStamp).toString(t.formats.date),timeStamp:u.current.period.last.timeStamp},ratios:s.pies(d)},next:{data:u.next.data,shortages:u.next.shortages,start:{date:new Date(u.next.period.first.timeStamp).toString(t.formats.date),timeStamp:u.next.period.first.timeStamp},end:{date:new Date(u.next.period.last.timeStamp).toString(t.formats.date),timeStamp:u.next.period.last.timeStamp},ratios:s.pies(u.next.data)}}})}else{null==r[0].diff&&(r[0].diff=0),null==r[0].wish&&(r[0].wish=0);var p=[{start:u.current.period.first.timeStamp/1e3,end:u.current.period.last.timeStamp/1e3,wish:r[0].wish,diff:r[0].diff}],g=[{start:u.next.period.first.timeStamp/1e3,end:u.next.period.last.timeStamp/1e3,wish:r[0].wish,diff:r[0].diff}];0>p[0].diff&&u.current.shortages.push(p[0]),0>g[0].diff&&u.next.shortages.push(g[0]),n.resolve({id:e.id,name:e.name,weeks:{current:{data:p,state:p,shortages:u.current.shortages,start:{date:new Date(u.current.period.first.timeStamp).toString(t.formats.date),timeStamp:u.current.period.first.timeStamp},end:{date:new Date(u.current.period.last.timeStamp).toString(t.formats.date),timeStamp:u.current.period.last.timeStamp},ratios:s.pies(p)},next:{data:g,shortages:u.next.shortages,start:{date:new Date(u.next.period.first.timeStamp).toString(t.formats.date),timeStamp:u.next.period.first.timeStamp},end:{date:new Date(u.next.period.last.timeStamp).toString(t.formats.date),timeStamp:u.next.period.last.timeStamp},ratios:s.pies(g)}}})}},function(e){n.resolve({error:e})}),n.promise},u.prototype.all=function(e){var t=r.defer(),n=(a.getPeriods(),{user:angular.fromJson(o.get("resources")).uuid,start:e.stamps.start/1e3,end:e.stamps.end/1e3});return u.query(n,function(a){if(e.layouts.group){var i={id:e.groupId,start:n.start,end:n.end,month:e.month};"all"!=e.division&&(i.division=e.division),u.prototype.aggs(i).then(function(i){if(e.layouts.members){var s=angular.fromJson(o.get(e.groupId)),l=[];angular.forEach(s,function(e){l.push(u.prototype.user({user:e.uuid,start:n.start,end:n.end,type:"both"}))}),r.all(l).then(function(n){t.resolve({user:a,groupId:e.groupId,aggs:i,members:n,synced:(new Date).getTime(),periods:{start:e.stamps.start,end:e.stamps.end}})})}else t.resolve({user:a,groupId:e.groupId,aggs:i,synced:(new Date).getTime(),periods:{start:e.stamps.start,end:e.stamps.end}})})}else t.resolve({user:a,synced:(new Date).getTime(),periods:{start:e.stamps.start,end:e.stamps.end}})},function(e){t.resolve({error:e})}),t.promise},u.prototype.user=function(e){var t=r.defer();return u.query(e,function(n){t.resolve({id:e.user,data:n,stats:s.member(n)})},function(e){t.resolve({error:e})}),t.promise},u.prototype.local=function(){return angular.fromJson(o.get("slots"))},u.prototype.add=function(e,t){var n=r.defer();return u.save({user:t},e,function(e){n.resolve(e)},function(e){n.resolve({error:e})}),n.promise},u.prototype.change=function(e,t,n){var o=r.defer();return u.change(angular.extend(l(t),{user:n}),l(e),function(e){o.resolve(e)},function(e){o.resolve({error:e})}),o.promise},u.prototype.remove=function(e,t){var n=r.defer();return u.remove(angular.extend(l(e),{user:t}),function(e){n.resolve(e)},function(e){n.resolve({error:e})}),n.promise},new u}]),angular.module("CapeClient.Modals.Messages",["ngResource"]).factory("Messages",["$rootScope","$config","$resource","$q","Storage",function(e,t,n,r,o){var a=n(t.host+"/question/:action",{},{query:{method:"GET",params:{action:"",0:"all",state:"NEW",limit:10,offset:0},isArray:!0},get:{method:"GET",params:{}},send:{method:"POST",params:{action:"sendDirectMessage"}},save:{method:"POST",params:{}},changeState:{method:"POST",params:{action:"changeState"}},remove:{method:"POST",params:{action:"deleteQuestions"}}});return a.prototype.query=function(){var e=r.defer();return a.query(function(t){console.warn("coming to here"),o.add("TEST","TESTING"),o.add("messages",angular.toJson(t)),a.prototype.unreadCount(),e.resolve(a.prototype.filter(t))},function(t){e.resolve({error:t})}),e.promise},a.prototype.queryTest=function(){var e=r.defer();return setTimeout(function(){o.add("messages",angular.toJson(messagesLocal)),a.prototype.unreadCount(),e.resolve(a.prototype.filter(messagesLocal))},100),e.promise},a.prototype.filter=function(e){var t={inbox:[],outbox:[],trash:[]};angular.forEach(e,function(e){""==e.subject&&(e.subject="-No Subject-"),"inbox"==e.box&&"TRASH"!=e.state?t.inbox.push(e):"outbox"==e.box&&"TRASH"!=e.state?t.outbox.push(e):"inbox"!=e.box&&"outbox"!=e.box||"TRASH"!=e.state||t.trash.push(e)});var n=function(e){for(var t=50,n=e.length,r=0,o=[];n>r*t;)o[r]=e.slice(r*t,(r+1)*t),r++;return o};return t.inbox=n(t.inbox),t.outbox=n(t.outbox),t.trash=n(t.trash),console.warn("filtered ->",t),t},a.prototype.local=function(){return angular.fromJson(o.get("messages"))},a.prototype.find=function(e){var t;return console.warn("asked for ->",e,a.prototype.local()),angular.forEach(a.prototype.local(),function(n){n.uuid==e&&(t=n)}),t},a.prototype.receviers=function(){var e=angular.fromJson(o.get("members")),t=angular.fromJson(o.get("groups")),n=[];return angular.forEach(e,function(e){n.push({id:e.uuid,name:e.name,group:"Users"})}),angular.forEach(t,function(e){n.push({id:e.uuid,name:e.name,group:"Groups"})}),n},a.prototype.send=function(e,t){var n=r.defer(),o=[],i=[];angular.forEach(e.receivers,function(e){o.push(e.id)}),i.push("paige"),t.sms&&i.push("sms"),t.email&&i.push("email");var e={members:o,content:e.body,subject:e.subject,types:i};return a.send(null,e,function(e){var t="";angular.forEach(e,function(e){t+=e}),n.resolve(t)},function(e){n.resolve({error:e})}),n.promise},a.prototype.unread=function(){var e=a.prototype.local(),t=[];return angular.forEach(e,function(e){"inbox"==e.box&&"NEW"==e.state&&t.push(e)}),t},a.prototype.unreadCount=function(){var t=a.prototype.local(),n=0;angular.forEach(t,function(e){"inbox"==e.box&&"NEW"==e.state&&n++}),e.app.unreadMessages=n},a.prototype.changeState=function(e,t){var n=r.defer();if(a.changeState(null,{ids:e,state:t},function(e){n.resolve(e)},function(e){n.resolve({error:e})}),"READ"==t){var i=angular.fromJson(o.get("messages")),s=[];angular.forEach(i,function(t){angular.forEach(e,function(e){t.uuid==e&&(t.state="READ")}),s.push(t)}),o.remove("messages"),o.add(angular.toJson("messages",s)),a.prototype.unreadCount()
}return n.promise},a.prototype.remove=function(e){var t=r.defer();return a.prototype.changeState(e,"TRASH").then(function(e){t.resolve(e)}),t.promise},a.prototype.restore=function(e){var t=r.defer();return a.prototype.changeState(e,"SEEN").then(function(e){t.resolve(e)}),t.promise},a.prototype.emptyTrash=function(){var e=r.defer(),t=a.prototype.local(),n=[];return angular.forEach(t,function(e){"inbox"!=e.box&&"outbox"!=e.box||"TRASH"!=e.state||n.push(e.uuid)}),a.remove(null,{members:n},function(t){e.resolve(t)},function(t){e.resolve({error:t})}),e.promise},a.prototype.clean=function(e){var t=r.defer();return angular.forEach(e,function(e){console.log("bulk ->",e)}),t.promise},new a}]),angular.module("CapeClient.Modals.Groups",["ngResource"]).factory("Groups",["$resource","$config","$q","Storage","$rootScope","Slots",function(e,t,n,r,o,a){var i=e(t.host+"/network/:action/:id",{},{query:{method:"GET",params:{},isArray:!0},get:{method:"GET",params:{id:""}},save:{method:"POST",params:{id:""}},edit:{method:"PUT",params:{id:""}},remove:{method:"DELETE",params:{id:""}},search:{method:"POST",params:{id:"",action:"searchPaigeUser"},isArray:!0}}),s=e(t.host+"/node/:id/container",{},{get:{method:"GET",params:{id:""},isArray:!0}}),l=e(t.host+"/parent",{},{get:{method:"GET",params:{},isArray:!0}}),u=e(t.host+"/network/:id/members/:mid",{},{query:{method:"GET",params:{id:"",fields:"[role, latlong, latlong_final, settingsWebPaige]"},isArray:!0},get:{method:"GET",params:{id:""}},save:{method:"POST",params:{}},add:{method:"POST",params:{id:"",mid:""}},remove:{method:"DELETE",params:{id:"",mid:""}}});return i.prototype.parents=function(e){var t=n.defer();return l.get(null,function(n){e?t.resolve(n):0==n.length?t.resolve(null):t.resolve(n[0].uuid)},function(e){t.resolve({error:e})}),t.promise},i.prototype.containers=function(e){var t=n.defer(),r=[];return s.get({id:e},function(e){angular.forEach(e,function(e){var t=[];angular.forEach(e,function(e){t+=e}),r.push(t)}),t.resolve(r)},function(e){t.resolve({error:e})}),t.promise},i.prototype.addMember=function(e){var t=n.defer();return u.add({id:e.group.uuid,mid:e.id},{},function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},i.prototype.removeMember=function(e,t){var r=n.defer();return u.remove({id:t,mid:e},function(e){r.resolve(e)},function(e){r.resolve({error:e})}),r.promise},i.prototype.removeMembers=function(e,t){var r=n.defer(),o=[];return angular.forEach(e,function(e,n){n&&o.push(i.prototype.removeMember(n,t.uuid))}),n.all(o).then(function(e){r.resolve(e)}),r.promise},i.prototype.wish=function(e){var t=n.defer(),r=0;return a.wishes({id:e,start:255600,end:860400}).then(function(e){angular.forEach(e,function(e){255600==e.start&&860400==e.end&&null!=e.count&&(r=e.count)}),t.resolve({count:r})}),t.promise},i.prototype.query=function(e){var t=n.defer();return i.query(function(o){if(r.add("groups",angular.toJson(o)),e)t.resolve(o);else{var a=[];angular.forEach(o,function(e){a.push(i.prototype.get(e.uuid))}),n.all(a).then(function(e){i.prototype.uniqueMembers();var n={};n.members={},angular.forEach(o,function(t){n.groups=o,n.members[t.uuid]=[],angular.forEach(e,function(e){e.id==t.uuid&&(n.members[t.uuid]=e.data)})}),t.resolve(n)})}},function(e){t.resolve({error:e})}),t.promise},i.prototype.get=function(e){var t=n.defer();return u.query({id:e},function(n){var o;o=4==n.length&&"n"==n[0][0]&&"u"==n[1][0]?[]:n,r.add(e,angular.toJson(o)),t.resolve({id:e,data:o})},function(e){t.resolve({error:e})}),t.promise},i.prototype.uniqueMembers=function(){angular.forEach(angular.fromJson(r.get("groups")),function(e){var t=angular.fromJson(r.get("members"))||{};angular.forEach(angular.fromJson(r.get(e.uuid)),function(e){t[e.uuid]=e}),r.add("members",angular.toJson(t))})},i.prototype.save=function(e){var t=n.defer();return e.id?i.edit({id:e.id},{name:e.name},function(){t.resolve(e.id)}):i.save({id:o.app.resources.uuid},e,function(e){var n="";angular.forEach(e,function(e){n+=e}),t.resolve(n)},function(e){t.resolve({error:e})}),t.promise},i.prototype.remove=function(e){var t=n.defer();return i.remove({id:e},function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},i.prototype.search=function(e){var t=n.defer();return i.search(null,{key:e},function(e){var n=[];angular.forEach(e,function(e){n.push({id:e.id,name:e.name,groups:i.prototype.getMemberGroups(e.id)})}),t.resolve(n)},function(e){t.resolve({error:e})}),t.promise},i.prototype.getMemberGroups=function(e){var t=angular.fromJson(r.get("groups")),n=[];return angular.forEach(t,function(t){var o=angular.fromJson(r.get(t.uuid));angular.forEach(o,function(r){r.uuid===e&&n.push({uuid:t.uuid,name:t.name})})}),n},new i}]),angular.module("CapeClient.Modals.Profile",["ngResource"]).factory("Profile",["$rootScope","$config","$resource","$q","Storage","Groups","Slots","MD5",function(e,t,n,r,o,a,i,s){var l=n(t.host+"/node/:id/:section",{},{get:{method:"GET",params:{id:"",section:"resource"}},save:{method:"PUT",params:{section:"resource"}},role:{method:"PUT",params:{section:"role"}}}),u=n(t.host+"/register",{direct:"true",module:"default"},{profile:{method:"GET",params:{uuid:"",pass:"",name:"",phone:""}}}),d=n(t.host+"/resources",{},{get:{method:"GET",params:{}},save:{method:"POST",params:{}}});return l.prototype.register=function(e){var t=r.defer();return u.profile({uuid:e.username,pass:s(e.password),name:e.name,phone:e.PhoneAddress},function(n){l.prototype.role(e.username,e.role.id).then(function(o){l.prototype.save(e.username,{EmailAddress:e.EmailAddress,PostAddress:e.PostAddress,PostZip:e.PostZip,PostCity:e.PostCity}).then(function(i){var s=[];angular.forEach(e.groups,function(t){s.push(a.addMember({id:e.username,group:t}))}),r.all(s).then(function(e){t.resolve({registered:n,roled:o,resourced:i,grouped:e})})})})},function(e){t.resolve({error:e})}),t.promise},l.prototype.role=function(e,t){var n=r.defer();return l.role({id:e},t,function(e){n.resolve(e)},function(e){n.resolve({error:e})}),n.promise},l.prototype.changePassword=function(e){var t=r.defer();return d.save(null,{askPass:s(e.new1)},function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},l.prototype.get=function(t,n){var a=r.defer();return l.get({id:t},function(r){t==e.app.resources.uuid&&(e.app.resources=r),n&&o.add("resources",angular.toJson(r)),a.resolve({resources:r})}),a.promise},l.prototype.getWithSlots=function(e,t,n){var o=r.defer();return l.prototype.get(e,t).then(function(t){i.user({user:e,start:n.start,end:n.end}).then(function(e){o.resolve(angular.extend(t,{slots:e,synced:(new Date).getTime(),periods:{start:1e3*n.start,end:1e3*n.end}}))})}),o.promise},l.prototype.getSlots=function(e,t){var n=r.defer();return i.user({user:e,start:t.start/1e3,end:t.end/1e3}).then(function(e){n.resolve({slots:e,synced:(new Date).getTime(),periods:{start:t.start,end:t.end}})}),n.promise},l.prototype.local=function(){return angular.fromJson(o.get("resources"))},l.prototype.save=function(e,t){var n=r.defer();return l.save({id:e},t,function(e){n.resolve(e)},function(e){n.resolve({error:e})}),n.promise},l.prototype.createSettings_=function(t){var n=r.defer();return l.prototype.get(t,!1).then(function(t){void 0==t.settingsWebPaige||null==t.settingsWebPaige?l.save({id:t.resources.uuid},angular.toJson({settingsWebPaige:e.config.defaults.settingsWebPaige}),function(e){n.resolve({status:"modified",resources:e})},function(e){n.resolve({error:e})}):n.resolve({status:"full",resources:t})}),n.promise},new l}]),angular.module("CapeClient.Modals.Settings",["ngResource"]).factory("Settings",["$rootScope","$config","$resource","$q","Storage","Profile",function(e,t,n,r,o,a){var i=n();return i.prototype.get=function(){return angular.fromJson(o.get("resources")).settingsWebPaige||{}},i.prototype.save=function(e,t){var n=r.defer();return a.save(e,{settingsWebPaige:angular.toJson(t)}).then(function(){n.resolve({saved:!0})}),n.promise},new i}]),angular.module("CapeClient.Controllers.Login",[]).controller("login",["$rootScope","$scope","Cape",function(e,t){t.user={name:"sstam",password:"askask"}}]),angular.module("CapeClient.Controllers.Planboard",[]).controller("planboard",["$rootScope","$scope","$q","$window","$location","Slots","Dater","Storage","Sloter","Cape",function(e,t,n,r,o,a,i,s,l,u){function d(e){var n=[];angular.forEach(e.result,function(e){n.push({start:e.start/1e3,end:e.end/1e3,text:angular.fromJson(e.value).event,type:"availability",recursive:!1})}),t.$apply(function(){t.data={periods:{start:t.periods.weeks[i.current.week()].first.timeStamp,end:t.periods.weeks[i.current.week()].last.timeStamp},user:n}}),s.add("data",angular.toJson(t.data)),console.log("scope data ->",angular.toJson(t.data))}e.fixStyles(),t.self=this,t.current={layouts:{user:!0,group:!0,members:!1},day:i.current.today(),week:i.current.week(),month:i.current.month(),division:"all"},t.periods=i.getPeriods(),t.slot={},t.timeline={id:"mainTimeline",main:!0,user:{id:"SSTAM",role:1},current:t.current,options:{start:new Date(t.periods.weeks[t.current.week].first.day),end:new Date(t.periods.weeks[t.current.week].last.day),min:new Date(t.periods.weeks[t.current.week].first.day),max:new Date(t.periods.weeks[t.current.week].last.day)},range:{start:t.periods.weeks[t.current.week].first.day,end:t.periods.weeks[t.current.week].last.day},scope:{day:!1,week:!0,month:!1},config:{bar:e.config.timeline.config.bar,wishes:e.config.timeline.config.wishes,legenda:{},legendarer:e.config.timeline.config.legendarer,states:e.config.timeline.config.states,divisions:e.config.timeline.config.divisions,densities:e.config.timeline.config.densities}},u.getSlots(t.periods.weeks[i.current.week()].first.timeStamp,t.periods.weeks[i.current.week()].last.timeStamp,function(e){d(e)}),angular.forEach(e.config.timeline.config.states,function(e,n){t.timeline.config.legenda[n]=!0}),t.timeline.config.legenda.groups={more:!0,even:!0,less:!0},t.daterange=i.readable.date(t.timeline.range.start)+" / "+i.readable.date(t.timeline.range.end);var c={};angular.forEach(t.timeline.config.states,function(e,t){c[t]=e.label}),t.states=c,t.divisions=t.timeline.config.divisions,t.resetViews=function(){t.views={slot:{add:!1,edit:!1},group:!1,wish:!1,member:!1}},t.resetViews(),t.toggleSlotForm=function(){t.views.slot.add?t.resetInlineForms():(t.slot={},t.slot={start:{date:(new Date).toString(e.config.formats.date),time:(new Date).toString(e.config.formats.time),datetime:(new Date).toISOString()},end:{date:(new Date).toString(e.config.formats.date),time:(new Date).addHours(1).toString(e.config.formats.time),datetime:(new Date).toISOString()},state:"",recursive:!1,id:""},t.resetViews(),t.views.slot.add=!0)},t.resetInlineForms=function(){t.slot={},t.original={},t.resetViews()}}]),angular.module("CapeClient.Controllers.Timeline",[]).controller("timeline",["$rootScope","$scope","$q","$location","Slots","Dater","Storage","Sloter","Profile","Cape",function(e,t,n,r,o,a,i,s,l,u){var d,c;t.$watch(function(){d=t.self.timeline.getVisibleChartRange(),c=a.calculate.diff(d),864e5>=c?t.timeline.scope={day:!0,week:!1,month:!1}:6048e5>c?t.timeline.scope={day:!1,week:!0,month:!1}:c>6048e5&&(t.timeline.scope={day:!1,week:!1,month:!0}),t.timeline.range={start:""+new Date(d.start),end:""+new Date(d.end)},t.daterange=a.readable.date(t.timeline.range.start)+" / "+a.readable.date(t.timeline.range.end)}),t.timeliner={init:function(){t.self.timeline=new links.Timeline(document.getElementById(t.timeline.id)),links.events.addListener(t.self.timeline,"rangechanged",this.getRange),links.events.addListener(t.self.timeline,"add",this.onAdd),links.events.addListener(t.self.timeline,"delete",this.onRemove),links.events.addListener(t.self.timeline,"change",this.onChange),links.events.addListener(t.self.timeline,"select",this.onSelect),this.render(t.timeline.options)},getRange:function(){t.timelineGetRange()},onAdd:function(){t.timelineOnAdd()},onRemove:function(){t.timelineOnRemove()},onChange:function(){t.timelineOnChange()},onSelect:function(){t.timelineOnSelect()},render:function(n){t.timeline={id:t.timeline.id,main:t.timeline.main,user:t.timeline.user,current:t.timeline.current,scope:t.timeline.scope,config:t.timeline.config,options:{start:new Date(n.start),end:new Date(n.end),min:new Date(n.start),max:new Date(n.end)}},angular.extend(t.timeline.options,e.config.timeline.options),console.warn("inside in processer ->",angular.fromJson(i.get("data"))),t.self.timeline.draw(s.process(t.data,t.timeline.config,t.divisions,t.timeline.user.role),t.timeline.options),t.self.timeline.setVisibleChartRange(t.timeline.options.start,t.timeline.options.end)},load:function(n){var r=this;e.statusBar.display(e.ui.planboard.refreshTimeline),u.getSlots(n.start,n.end,function(e){var r=[];angular.forEach(e.result,function(e){console.log("slot ->",e),r.push({start:e.start,end:e.end,text:angular.fromJson(e.value).event,type:"availability",recursive:!1})}),console.log("timedata ->",r),t.data={periods:{start:n.start,end:n.end},user:r},i.add("data",angular.toJson(t.data))}),r.render(n),e.statusBar.off()},refresh:function(){t.slot={},t.timeline.main?(t.resetViews(),t.views.slot.add=!0):t.forms={add:!0,edit:!1},this.load({start:t.data.periods.start,end:t.data.periods.end})},redraw:function(){t.self.timeline.redraw()},isAdded:function(){return $(".timeline-event-content").contents().filter(function(){return"New"==this.nodeValue}).length},cancelAdd:function(){t.self.timeline.cancelAdd()}},t.timeline&&t.timeliner.init(),e.$on("timeliner",function(){t.timeliner.load({start:new Date(arguments[1].start).getTime(),end:new Date(arguments[1].end).getTime()})}),t.requestTimeline=function(e){switch(e){case"group":t.timeline.current.layouts.group=!t.timeline.current.layouts.group,t.timeline.current.layouts.members&&!t.timeline.current.layouts.group&&(t.timeline.current.layouts.members=!1);break;case"members":t.timeline.current.layouts.members=!t.timeline.current.layouts.members,t.timeline.current.layouts.members&&!t.timeline.current.layouts.group&&(t.timeline.current.layouts.group=!0)}t.timeliner.load({start:t.data.periods.start,end:t.data.periods.end})},t.timelineGetRange=function(){var e=t.self.timeline.getVisibleChartRange();t.$apply(function(){t.timeline.range={start:""+new Date(e.from),end:""+new Date(e.till)},t.timeline.main&&(t.daterange={start:a.readable.date(new Date(e.start).getTime()),end:a.readable.date(new Date(e.end).getTime())})})},t.selectedSlot=function(){var n;if(t.timeliner.cancelAdd(),n=t.self.timeline.getSelection()[0]){var r=t.self.timeline.getItem(n.row),o=angular.fromJson(r.content.match(/<span class="secret">(.*)<\/span>/)[1])||null;if(t.original={start:r.start,end:r.end,content:{recursive:o.recursive,state:o.state,id:o.id}},t.timeline.main?t.resetViews():t.forms={add:!1,edit:!0},o.type){if(t.timeline.main)switch(o.type){case"slot":t.views.slot.edit=!0;break;case"group":t.views.group=!0;break;case"wish":t.views.wish=!0;break;case"member":t.views.member=!0}if(t.slot={start:{date:new Date(r.start).toString(e.config.formats.date),time:new Date(r.start).toString(e.config.formats.time),datetime:new Date(r.start).toISOString()},end:{date:new Date(r.end).toString(e.config.formats.date),time:new Date(r.end).toString(e.config.formats.time),datetime:new Date(r.end).toISOString()},state:o.state,recursive:o.recursive,id:o.id},t.timeline.main)switch(o.type){case"group":t.slot.diff=o.diff,t.slot.group=o.group;break;case"wish":t.slot.wish=o.wish,t.slot.group=o.group,t.slot.groupId=o.groupId;break;case"member":t.slot.member=o.mid}}return r}},t.timelineOnSelect=function(){t.$apply(function(){t.selectedOriginal=t.selectedSlot()})},t.destroy={timeline:function(){},statistics:function(){setTimeout(function(){t.timeliner.redraw()},10)}},t.barCharts=function(){t.timeline.config.bar=!t.timeline.config.bar,t.timeliner.render({start:t.timeline.range.start,end:t.timeline.range.end})},t.groupWishes=function(){t.timeline.config.wishes=!t.timeline.config.wishes,t.timeliner.render({start:t.timeline.range.start,end:t.timeline.range.end})},t.showLegenda=function(){t.timeline.config.legendarer=!t.timeline.config.legendarer},t.alterLegenda=function(e){t.timeline.config.legenda=e,t.timeliner.render({start:t.timeline.range.start,end:t.timeline.range.end})},t.timelineOnAdd=function(e,t){u.setSlot(a.convert.absolute(t.start.date,t.start.time,!1),a.convert.absolute(t.end.date,t.end.time,!1),t.state,t.recursive,function(e){console.log("slot successfully added ->",e)})},t.timelineOnChange=function(n,r,i,s){if(n)var s={start:e.browser.mobile?new Date(i.start.datetime).getTime():a.convert.absolute(i.start.date,i.start.time,!1),end:e.browser.mobile?new Date(i.end.datetime).getTime():a.convert.absolute(i.end.date,i.end.time,!1),content:angular.toJson({recursive:i.recursive,state:i.state})};else var l=t.self.timeline.getItem(t.self.timeline.getSelection()[0].row),s={start:l.start,end:l.end,content:angular.fromJson(l.content.match(/<span class="secret">(.*)<\/span>/)[1])};var u=Date.now().getTime();u>=s.end&&0==s.content.recursive?(e.notifier.error("You can not change timeslots in past."),t.timeliner.refresh()):(e.statusBar.display(e.ui.planboard.changingSlot),o.change(t.original,s,t.timeline.user.id).then(function(n){n.error?(e.notifier.error("Error with changing timeslot."),console.warn("error ->",n)):e.notifier.success(e.ui.planboard.slotChanged),t.timeliner.refresh()}))},t.timelineOnRemove=function(){if(t.timeliner.isAdded()>0)t.self.timeline.cancelAdd(),t.$apply(function(){t.resetInlineForms()});else{var n=Date.now().getTime();n>=t.original.end.getTime()&&0==t.original.recursive?(e.notifier.error("You can not delete timeslots in past."),t.timeliner.refresh()):(e.statusBar.display(e.ui.planboard.deletingTimeslot),o.remove(t.original,t.timeline.user.id).then(function(n){n.error?(e.notifier.error("Error with removing timeslot."),console.warn("error ->",n)):e.notifier.success(e.ui.planboard.timeslotDeleted),t.timeliner.refresh()}))}},t.wisher=function(n){e.statusBar.display(e.ui.planboard.changingWish),o.setWish({id:n.groupId,start:e.browser.mobile?new Date(n.start.datetime).getTime()/1e3:a.convert.absolute(n.start.date,n.start.time,!0),end:e.browser.mobile?new Date(n.end.datetime).getTime()/1e3:a.convert.absolute(n.end.date,n.end.time,!0),recursive:!1,wish:n.wish}).then(function(n){n.error?(e.notifier.error("Error with changing wish value."),console.warn("error ->",n)):e.notifier.success(e.ui.planboard.wishChanged),t.timeliner.refresh()})},setTimeout(function(){t.self.timeline.redraw()},100)}]),angular.module("CapeClient.Controllers.Timeline.Navigation",[]).controller("timeline-navigation",["$rootScope","$scope","$window",function(e,t,n){t.timelineScoper=function(e){switch(t.timeline.current.day=t.current.day,t.timeline.current.week=t.current.week,t.timeline.current.month=t.current.month,e){case"day":t.timeline.scope={day:!0,week:!1,month:!1},t.timeliner.load({start:t.periods.days[t.timeline.current.day].first.timeStamp,end:t.periods.days[t.timeline.current.day].last.timeStamp});break;case"week":t.timeline.scope={day:!1,week:!0,month:!1},t.timeliner.load({start:t.periods.weeks[t.timeline.current.week].first.timeStamp,end:t.periods.weeks[t.timeline.current.week].last.timeStamp});break;case"month":t.timeline.scope={day:!1,week:!1,month:!0},t.timeliner.load({start:t.periods.months[t.timeline.current.month].first.timeStamp,end:t.periods.months[t.timeline.current.month].last.timeStamp})}},t.timelineBefore=function(){t.timeline.scope.day?1!=t.timeline.current.day&&(t.timeline.current.day--,t.timeliner.load({start:t.periods.days[t.timeline.current.day].first.timeStamp,end:t.periods.days[t.timeline.current.day].last.timeStamp})):t.timeline.scope.week?1!=t.timeline.current.week&&(t.timeline.current.week--,t.timeliner.load({start:t.periods.weeks[t.timeline.current.week].first.timeStamp,end:t.periods.weeks[t.timeline.current.week].last.timeStamp})):t.timeline.scope.month&&1!=t.timeline.current.month&&(t.timeline.current.month--,t.timeliner.load({start:t.periods.months[t.timeline.current.month].first.timeStamp,end:t.periods.months[t.timeline.current.month].last.timeStamp}))},t.timelineAfter=function(){t.timeline.scope.day?t.timeline.current.day!=t.periods.days.total&&(t.timeline.current.day++,t.timeliner.load({start:t.periods.days[t.timeline.current.day].first.timeStamp,end:t.periods.days[t.timeline.current.day].last.timeStamp})):t.timeline.scope.week?53!=t.timeline.current.week&&(t.timeline.current.week++,t.timeliner.load({start:t.periods.weeks[t.timeline.current.week].first.timeStamp,end:t.periods.weeks[t.timeline.current.week].last.timeStamp})):t.timeline.scope.month&&12!=t.timeline.current.month&&(t.timeline.current.month++,t.timeliner.load({start:t.periods.months[t.timeline.current.month].first.timeStamp,end:t.periods.months[t.timeline.current.month].last.timeStamp}))},t.timelineThisWeek=function(){t.timeline.current.week!=(new Date).getWeek()&&(t.timeliner.load({start:t.periods.weeks[(new Date).getWeek()].first.timeStamp,end:t.periods.weeks[(new Date).getWeek()].last.timeStamp}),t.timeline.range={start:t.periods.weeks[(new Date).getWeek()].first.day,end:t.periods.weeks[(new Date).getWeek()].last.day})},t.timelineWeekBefore=function(){1!=t.timeline.current.week&&(t.timeline.current.week--,t.timeliner.load({start:t.periods.weeks[t.timeline.current.week].first.timeStamp,end:t.periods.weeks[t.timeline.current.week].last.timeStamp})),t.timeline.range={start:t.periods.weeks[t.timeline.current.week].first.day,end:t.periods.weeks[t.timeline.current.week].last.day}},t.timelineWeekAfter=function(){53!=t.timeline.current.week&&(t.timeline.current.week++,t.timeliner.load({start:t.periods.weeks[t.timeline.current.week].first.timeStamp,end:t.periods.weeks[t.timeline.current.week].last.timeStamp})),t.timeline.range={start:t.periods.weeks[t.timeline.current.week].first.day,end:t.periods.weeks[t.timeline.current.week].last.day}},t.timelineZoomIn=function(){t.self.timeline.zoom(e.config.timeline.config.zoom,Date.now())},t.timelineZoomOut=function(){t.self.timeline.zoom(-e.config.timeline.config.zoom,Date.now())},n.onresize=function(){t.self.timeline.redraw()},t.fullWidth=function(){console.log("ok!"),t.self.timeline.redraw()}}]),angular.module("$strap.config",[]).value("$strap.config",{}),angular.module("$strap.filters",["$strap.config"]),angular.module("$strap.directives",["$strap.config"]),angular.module("$strap",["$strap.filters","$strap.directives","$strap.config"]),angular.module("$strap.directives").directive("bsAlert",["$parse","$timeout","$compile",function(e,t,n){return{restrict:"A",link:function(t,r,o){var a=e(o.bsAlert),i=(a.assign,a(t));o.bsAlert?t.$watch(o.bsAlert,function(e,a){i=e,r.html((e.title?"<strong>"+e.title+"</strong>&nbsp;":"")+e.content||""),e.closed&&r.hide(),n(r.contents())(t),(e.type||a.type)&&(a.type&&r.removeClass("alert-"+a.type),e.type&&r.addClass("alert-"+e.type)),(angular.isUndefined(o.closeButton)||"0"!==o.closeButton&&"false"!==o.closeButton)&&r.prepend('<button type="button" class="close" data-dismiss="alert">&times;</button>')},!0):(angular.isUndefined(o.closeButton)||"0"!==o.closeButton&&"false"!==o.closeButton)&&r.prepend('<button type="button" class="close" data-dismiss="alert">&times;</button>'),r.addClass("alert").alert(),r.hasClass("fade")&&(r.removeClass("in"),setTimeout(function(){r.addClass("in")}));var s=o.ngRepeat&&o.ngRepeat.split(" in ").pop();r.on("close",function(e){var n;s?(e.preventDefault(),r.removeClass("in"),n=function(){r.trigger("closed"),t.$parent&&t.$parent.$apply(function(){for(var e=s.split("."),n=t.$parent,r=0;e.length>r;++r)n&&(n=n[e[r]]);n&&n.splice(t.$index,1)})},$.support.transition&&r.hasClass("fade")?r.on($.support.transition.end,n):n()):i&&(e.preventDefault(),r.removeClass("in"),n=function(){r.trigger("closed"),t.$apply(function(){i.closed=!0})},$.support.transition&&r.hasClass("fade")?r.on($.support.transition.end,n):n())})}}}]),angular.module("$strap.directives").directive("bsButton",["$parse","$timeout",function(e){return{restrict:"A",require:"?ngModel",link:function(t,n,r,o){if(o){n.parent('[data-toggle="buttons-checkbox"], [data-toggle="buttons-radio"]').length||n.attr("data-toggle","button");var a=!!t.$eval(r.ngModel);a&&n.addClass("active"),t.$watch(r.ngModel,function(e,t){var r=!!e,o=!!t;r!==o?$.fn.button.Constructor.prototype.toggle.call(i):r&&!a&&n.addClass("active")})}n.hasClass("btn")||n.on("click.button.data-api",function(){n.button("toggle")}),n.button();var i=n.data("button");i.toggle=function(){if(!o)return $.fn.button.Constructor.prototype.toggle.call(this);var r=n.parent('[data-toggle="buttons-radio"]');r.length?(n.siblings("[ng-model]").each(function(n,r){e($(r).attr("ng-model")).assign(t,!1)}),t.$digest(),o.$modelValue||(o.$setViewValue(!o.$modelValue),t.$digest())):t.$apply(function(){o.$setViewValue(!o.$modelValue)})}}}}]).directive("bsButtonsCheckbox",["$parse",function(){return{restrict:"A",require:"?ngModel",compile:function(e){e.attr("data-toggle","buttons-checkbox").find("a, button").each(function(e,t){$(t).attr("bs-button","")})}}}]).directive("bsButtonsRadio",["$parse",function(){return{restrict:"A",require:"?ngModel",compile:function(e,t){return e.attr("data-toggle","buttons-radio"),t.ngModel||e.find("a, button").each(function(e,t){$(t).attr("bs-button","")}),function(e,t,n,r){r&&(t.find("[value]").button().filter('[value="'+e.$eval(n.ngModel)+'"]').addClass("active"),t.on("click.button.data-api",function(t){e.$apply(function(){r.$setViewValue($(t.target).closest("button").attr("value"))})}),e.$watch(n.ngModel,function(r,o){if(r!==o){var a=t.find('[value="'+e.$eval(n.ngModel)+'"]');a.length&&$.fn.button.Constructor.prototype.toggle.call(a.data("button"))}}))}}}}]),angular.module("$strap.directives").directive("bsButtonSelect",["$parse","$timeout",function(e){return{restrict:"A",require:"?ngModel",link:function(t,n,r,o){var a=e(r.bsButtonSelect);a.assign,o&&(n.text(t.$eval(r.ngModel)),t.$watch(r.ngModel,function(e){n.text(e)}));var i,s,l,u;n.bind("click",function(){i=a(t),s=o?t.$eval(r.ngModel):n.text(),l=i.indexOf(s),u=l>i.length-2?i[0]:i[l+1],console.warn(i,u),t.$apply(function(){n.text(u),o&&o.$setViewValue(u)})})}}}]),angular.module("$strap.directives").directive("bsDatepicker",["$timeout",function(){var e="ontouchstart"in window&&!window.navigator.userAgent.match(/PhantomJS/i),t={"/":"[\\/]","-":"[-]",".":"[.]",dd:"(?:(?:[0-2]?[0-9]{1})|(?:[3][01]{1}))",d:"(?:(?:[0-2]?[0-9]{1})|(?:[3][01]{1}))",mm:"(?:[0]?[1-9]|[1][012])",m:"(?:[0]?[1-9]|[1][012])",yyyy:"(?:(?:[1]{1}[0-9]{1}[0-9]{1}[0-9]{1})|(?:[2]{1}[0-9]{3}))(?![[0-9]])",yy:"(?:(?:[0-9]{1}[0-9]{1}))(?![[0-9]])"};return{restrict:"A",require:"?ngModel",link:function(n,r,o,a){var i=function(e,n){n||(n={});var r=e,o=t;return angular.forEach(o,function(e,t){r=r.split(t).join(e)}),RegExp("^"+r+"$",["i"])},s=e?"yyyy/mm/dd":i(o.dateFormat||"mm/dd/yyyy");a&&a.$parsers.unshift(function(e){return!e||s.test(e)?(a.$setValidity("date",!0),e):(a.$setValidity("date",!1),void 0)});var l=r.next('[data-toggle="datepicker"]');if(l.length&&l.on("click",function(){e?r.trigger("focus"):r.datepicker("show")}),e&&"text"===r.prop("type"))r.prop("type","date"),r.on("change",function(){n.$apply(function(){a.$setViewValue(r.val())})});else{a&&r.on("changeDate",function(){n.$apply(function(){a.$setViewValue(r.val())})});var u=r.closest(".popover");u&&u.on("hide",function(){var e=r.data("datepicker");e&&(e.picker.remove(),r.data("datepicker",null))}),r.attr("data-toggle","datepicker"),r.datepicker({autoclose:!0,forceParse:o.forceParse||!1,language:o.language||"en"})}}}}]),angular.module("$strap.directives").directive("bsDropdown",["$parse","$compile",function(e,t){var n=Array.prototype.slice,r='<ul class="dropdown-menu" role="menu" aria-labelledby="drop1"><li ng-repeat="item in items" ng-class="{divider: !!item.divider, \'dropdown-submenu\': !!item.submenu && item.submenu.length}"><a ng-hide="!!item.divider" tabindex="-1" ng-href="{{item.href}}" ng-click="{{item.click}}" target="{{item.target}}" ng-bind-html-unsafe="item.text"></a></li></ul>',o=function(e,n,o){for(var i,s,l,u=0,d=e.length;d>u;u++)(i=e[u].submenu)&&(l=o.$new(),l.items=i,s=t(r)(l),s=s.appendTo(n.children("li:nth-child("+(u+1)+")")),a(i,s,l))},a=function(){var e=n.call(arguments);setTimeout(function(){o.apply(null,e)})};return{restrict:"EA",scope:!0,link:function(n,o,i){var s=e(i.bsDropdown);n.items=s(n);var l=t(r)(n);a(n.items,l,n),l.insertAfter(o),o.addClass("dropdown-toggle").attr("data-toggle","dropdown")}}}]),angular.module("$strap.directives").directive("bsModal",["$parse","$compile","$http","$timeout","$q","$templateCache",function(e,t,n,r,o,a){return{restrict:"A",scope:!0,link:function(i,s,l){var u=e(l.bsModal),d=(u.assign,u(i));o.when(a.get(d)||n.get(d,{cache:!0})).then(function(e){angular.isObject(e)&&(e=e.data);var n=u(i).replace(".html","").replace(/[\/|\.|:]/g,"-")+"-"+i.$id,o=$('<div class="modal hide" tabindex="-1"></div>').attr("id",n).attr("data-backdrop",l.backdrop||!0).attr("data-keyboard",l.keyboard||!0).addClass(l.modalClass?"fade "+l.modalClass:"fade").html(e);$("body").append(o),s.attr("href","#"+n).attr("data-toggle","modal"),r(function(){t(o)(i)}),i._modal=function(e){o.modal(e)},i.hide=function(){o.modal("hide")},i.show=function(){o.modal("show")},i.dismiss=i.hide})}}}]),angular.module("$strap.directives").directive("bsNavbar",["$location",function(e){return{restrict:"A",link:function(t,n){t.$watch(function(){return e.path()},function(e){n.find("li[data-match-route]").each(function(t,n){var r=angular.element(n),o=r.attr("data-match-route"),a=RegExp("^"+o+"$",["i"]);a.test(e)?r.addClass("active"):r.removeClass("active")})})}}}]),angular.module("$strap.directives").directive("bsPopover",["$parse","$compile","$http","$timeout","$q","$templateCache",function(e,t,n,r,o,a){return $("body").on("keyup",function(e){27===e.keyCode&&$(".popover.in").each(function(){$(this).popover("hide")})}),{restrict:"A",scope:!0,link:function(r,i,s){var l=e(s.bsPopover),u=(l.assign,l(r)),d={};angular.isObject(u)&&(d=u),o.when(d.content||a.get(u)||n.get(u,{cache:!0})).then(function(e){angular.isObject(e)&&(e=e.data),s.unique&&i.on("show",function(){$(".popover.in").each(function(){var e=$(this),t=e.data("popover");t&&!t.$element.is(i)&&e.popover("hide")})}),s.hide&&r.$watch(s.hide,function(e,t){e?n.hide():e!==t&&n.show()}),i.popover(angular.extend({},d,{content:e,html:!0}));var n=i.data("popover");n.hasContent=function(){return this.getTitle()||e},n.getPosition=function(){var e=$.fn.popover.Constructor.prototype.getPosition.apply(this,arguments);return t(this.$tip)(r),r.$digest(),this.$tip.data("popover",this),e},r._popover=function(e){i.popover(e)},r.hide=function(){i.popover("hide")},r.show=function(){i.popover("show")},r.dismiss=r.hide})}}}]),angular.module("$strap.directives").directive("bsTabs",["$parse","$compile",function(e,t){return{restrict:"A",link:function(e,n){var r=['<ul class="nav nav-tabs">',"</ul>"],o=['<div class="tab-content">',"</div>"];n.find("[data-tab]").each(function(t){var n=angular.element(this),a="tab-"+e.$id+"-"+t,i=n.hasClass("active"),s=n.hasClass("fade"),l=e.$eval(n.data("tab"));r.splice(t+1,0,"<li"+(i?' class="active"':"")+'><a href="#'+a+'" data-toggle="tab">'+l+"</a></li>"),o.splice(t+1,0,'<div class="tab-pane '+n.attr("class")+(s&&i?" in":"")+'" id="'+a+'">'+this.innerHTML+"</div>")}),n.html(r.join("")+o.join("")),t(n.children("div.tab-content"))(e)}}}]),angular.module("$strap.directives").directive("bsTimepicker",["$timeout",function(){var e="((?:(?:[0-1][0-9])|(?:[2][0-3])|(?:[0-9])):(?:[0-5][0-9])(?::[0-5][0-9])?(?:\\s?(?:am|AM|pm|PM))?)";return{restrict:"A",require:"?ngModel",link:function(t,n,r,o){o&&n.on("change",function(){t.$apply(function(){o.$setViewValue(n.val())})});var a=RegExp("^"+e+"$",["i"]);o.$parsers.unshift(function(e){return!e||a.test(e)?(o.$setValidity("time",!0),e):(o.$setValidity("time",!1),void 0)});var i=n.closest(".popover");i&&i.on("hide",function(){var e=n.data("timepicker");e&&(e.$widget.remove(),n.data("timepicker",null))
}),n.attr("data-toggle","timepicker"),n.timepicker()}}}]),angular.module("$strap.directives").directive("bsTooltip",["$parse","$compile",function(e){return{restrict:"A",scope:!0,link:function(t,n,r){var o=e(r.bsTooltip),a=(o.assign,o(t));t.$watch(r.bsTooltip,function(e,t){e!==t&&(a=e)}),r.unique&&n.on("show",function(){$(".tooltip.in").each(function(){var e=$(this),t=e.data("tooltip");t&&!t.$element.is(n)&&e.tooltip("hide")})}),n.tooltip({title:function(){return angular.isFunction(a)?a.apply(null,arguments):a},html:!0});var i=n.data("tooltip");i.show=function(){var e=$.Event("show");if(this.$element.trigger(e),!e.isDefaultPrevented()){var t=$.fn.tooltip.Constructor.prototype.show.apply(this,arguments);return this.tip().data("tooltip",this),t}},i.hide=function(){var e=$.Event("hide");return this.$element.trigger(e),e.isDefaultPrevented()?void 0:$.fn.tooltip.Constructor.prototype.hide.apply(this,arguments)},t._tooltip=function(e){n.tooltip(e)},t.hide=function(){n.tooltip("hide")},t.show=function(){n.tooltip("show")},t.dismiss=t.hide}}}]),angular.module("$strap.directives").directive("bsTypeahead",["$parse",function(e){return{restrict:"A",require:"?ngModel",link:function(t,n,r,o){var a=e(r.bsTypeahead),i=(a.assign,a(t));t.$watch(r.bsTypeahead,function(e,t){e!==t&&(i=e)}),n.attr("data-provide","typeahead"),n.typeahead({source:function(){return angular.isFunction(i)?i.apply(null,arguments):i},minLength:r.minLength||1,items:r.items,updater:function(e){return o&&t.$apply(function(){o.$setViewValue(e)}),e}});var s=n.data("typeahead");s.lookup=function(){var e;return this.query=this.$element.val()||"",this.query.length<this.options.minLength?this.shown?this.hide():this:(e=$.isFunction(this.source)?this.source(this.query,$.proxy(this.process,this)):this.source,e?this.process(e):this)},"0"===r.minLength&&setTimeout(function(){n.on("focus",function(){0===n.val().length&&setTimeout(n.typeahead.bind(n,"lookup"),200)})})}}}]),angular.module("CapeClient.Modals.Cape",[]).factory("Cape",["$rootScope","$config","$q",function(e,t){var n=function(){this.server=t.host,this.requestid=0,this.stateAgentUrl=null,this.requests=[],this.connection=new Strophe.Connection(this.server);var e=localStorage.capeclient_sid,n=localStorage.capeclient_rid,r=localStorage.capeclient_jid;this.stateAgentUrl=localStorage.capeclient_sa,this.userid=localStorage.capeclient_uid;var o=this;null!==e&&null!=r&&(console.log("reconnecting"),this.connection.attach(r,e,n+1,function(e){e==Strophe.Status.ATTACHED?(console.log("reconnected"),$iq({to:Strophe.getDomainFromJid(r),type:"get"}).c("query",{xmlns:"http://jabber.org/protocol/disco#info"}),o.connected()):e==Strophe.Status.CONNFAIL?console.log("Strophe failed to connect."):e==Strophe.Status.DISCONNECTING?console.log("Strophe is disconnecting."):e==Strophe.Status.DISCONNECTED?(console.log("Strophe is disconnected."),o.disconnected()):e==Strophe.Status.CONNECTED?(console.log("Strophe is connected."),o.connected(null)):e==Strophe.Status.CONNFAIL&&console.log("Strophe failed to connect.")}))},r=function(e){this.connection=e};return r.prototype.send=function(e,t,n,r){var o={};o.id=e,o.method=n,o.params=r;var a=JSON.stringify(o),i=$msg({to:t,from:this.username,type:"chat"}).c("body").t(a);console.log("Sending: ",a),this.connection.send(i.tree())},n.prototype.login=function(e,t,n){function r(e){e==Strophe.Status.CONNECTING?console.log("Strophe is connecting."):e==Strophe.Status.CONNFAIL?console.log("Strophe failed to connect."):e==Strophe.Status.DISCONNECTING?(console.log("Strophe is disconnecting."),o.disconnected()):e==Strophe.Status.CONNECTED?(console.log("Strophe is connected."),o.connected(n)):e==Strophe.Status.AUTHFAIL?console.log("Strophe failed to connect."):e==Strophe.Status.ERROR&&console.log("Strophe failed to connect.")}this.userid=e,this.username=e+"@openid.ask-cs.com/web";var o=this;this.connection.connect(this.username,t,r)},n.prototype.connected=function(e){function t(e){var t=(e.getAttribute("to"),e.getAttribute("from")),r=(e.getAttribute("type"),e.getElementsByTagName("body")),o=e.getElementsByTagName("error");if(r.length>0){var a=r[0],i=JSON.parse(Strophe.getText(a));if(console.warn("Result ->",i),null!==i.result){var s=n.requests[i.id];null!==s&&(s(i),n.requests.splice(i.id,1))}else null!==i.method&&console.log("Received new call: ",i)}if(o.length>0){var l=o[0];console.log(l),console.log("Received error from "+t+": "+Strophe.getText(l))}return!0}localStorage.capeclient_sid=this.connection.sid,localStorage.capeclient_rid=this.connection.rid,localStorage.capeclient_jid=this.connection.jid,localStorage.capeclient_uid=this.userid,this.connection.addHandler(t,null,"message",null,null,null),this.connection.send($pres().tree());var n=this;void 0==this.stateAgentUrl?this.findDatasource(this.userid,"state",function(t){n.stateAgentUrl=t.result[0].agentUrl.replace("xmpp:",""),localStorage.capeclient_sa=n.stateAgentUrl,null!==e&&e()}):null!==e&&e()},n.prototype.disconnect=function(e){this.connection.disconnect(),e()},n.prototype.disconnected=function(){console.log("Disconnected!"),localStorage.removeItem("capeclient_sid"),localStorage.removeItem("capeclient_rid"),localStorage.removeItem("capeclient_jid"),localStorage.removeItem("capeclient_sa")},n.prototype.findDatasource=function(e,t,n){var r="merlin@openid.ask-cs.com/merlin",o={};o.userId=e,o.dataType=t,this.call(r,"find",o,n)},n.prototype.getSlots=function(e,t,n){if(null===this.stateAgentUrl)throw"No stateAgent found";null===e&&(e=(new Date).getTime()),null===t&&(t=e+1);var r={};r.start_millis=e,r.end_millis=t,this.call(this.stateAgentUrl,"getSlotsCombined",r,n)},n.prototype.setSlot=function(e,t,n,r,o){if(null===this.stateAgentUrl)throw"No stateAgent found";var a={};a.start_millis=e,a.end_millis=t,a.description=n,a.occurence=r?"WEEKLY":"ONCE",this.call(this.stateAgentUrl,"setSlot",a,o)},n.prototype.isConnected=function(){return this.connection.connected},n.prototype.call=function(e,t,n,o){this.requestid++;var a=new r(this.connection);a.send(this.requestid,e,t,n),this.requests[this.requestid]=o},new n}]),angular.module("CapeClient.Services.Timer",["ngResource"]).factory("Timer",["$rootScope","$timeout",function(e,t){var n=[],r=function(e,r,o){n[e]={event:r,delay:o,counter:0};var a=function(){n[e].counter++,n[e].mytimeout=t(a,1e3*o),n[e].delay==n[e].counter&&(n[e].event.call(),n[e].counter=0)};n[e].mytimeout=t(a,1e3*o)},o=function(e){t.cancel(n[e].mytimeout)};return{start:r,stop:o}}]),angular.module("CapeClient.Services.Session",["ngResource"]).factory("Session",["$rootScope","$http","Storage",function(e,t,n){return{check:function(){var e=angular.fromJson(n.cookie.get("session"));return e?(this.set(e.id),!0):!1},cookie:function(){for(var e,t=document.cookie.split(";"),n=0;t.length>n;n++)if(e=t[n].split("="),"WebPaige.session"==e[0].trim())return angular.fromJson(e[1])},get:function(e){return this.check(e),this.set(e.id),e.id},set:function(r){var o={id:r,time:new Date};return n.cookie.add("session",angular.toJson(o)),e.session=o,t.defaults.headers.common["X-SESSION_ID"]=e.session.id,o},clear:function(){e.session=null,t.defaults.headers.common["X-SESSION_ID"]=null}}}]),angular.module("CapeClient.Services.Dater",["ngResource"]).factory("Dater",["$rootScope","Storage",function(e,t){return{current:{today:function(){return Date.today().getDayOfYear()+1},week:function(){return(new Date).getWeek()},month:function(){return(new Date).getMonth()+1}},readable:{date:function(t){return new Date(t).toString(e.config.formats.date)}},convert:{absolute:function(e,t,n){var r=e.split("-"),o=new Date(Date.parse(r[2]+"-"+r[1]+"-"+r[0]+" "+t)).getTime();return n?o/1e3:o}},calculate:{diff:function(e){return new Date(e.end).getTime()-new Date(e.start).getTime()}},getThisMonth:function(){return(new Date).toString("M")},getThisYear:function(){return(new Date).toString("yyyy")},getMonthTimeStamps:function(){for(var e={},t=this.getThisYear(),n=0;12>n;n++){var r=new Date(t,n).moveToFirstDayOfMonth(),o=new Date(t,n).moveToLastDayOfMonth(),a={first:{day:r,timeStamp:r.getTime()},last:{day:o,timeStamp:o.getTime()},totalDays:Date.getDaysInMonth(t,n)};e[n+1]=a}return e},getWeekTimeStamps:function(){for(var e,t=[],n={},r=this.getThisYear(),o=(new Date(r,0).moveToFirstDayOfMonth(),new Date(r,0).moveToFirstDayOfMonth().last().sunday().addWeeks(0)),a=new Date(o),i=0;53>i;i++)e=0==i?o.addWeeks(1):new Date(t[i-1]).addWeeks(1),t.push(new Date(e));t.unshift(a),new Date(t[51].addWeeks(1));for(var i=0;55>i;i++)n[i+1]={first:{day:t[i],timeStamp:new Date(t[i]).getTime()},last:{day:t[i+1],timeStamp:new Date(t[i+1]).getTime()}};return delete n[54],delete n[55],n},getDayTimeStamps:function(){for(var e,t=[],n={},r=this.getThisYear(),o=new Date(r,0).moveToFirstDayOfMonth(),a=0;366>a;a++)e=0==a?o:new Date(t[a-1]).addDays(1),t.push(new Date(e));for(var a=0;366>a;a++)n[a+1]={first:{day:t[a],timeStamp:new Date(t[a]).getTime()},last:{day:t[a+1],timeStamp:new Date(t[a+1]).getTime()}};return n[366].timeStamp?n.total=366:(delete n[366],n.total=365),n},registerPeriods:function(){angular.fromJson(t.get("periods")||"{}"),t.add("periods",angular.toJson({months:this.getMonthTimeStamps(),weeks:this.getWeekTimeStamps(),days:this.getDayTimeStamps()}))},getPeriods:function(){return angular.fromJson(t.get("periods"))}}}]),angular.module("CapeClient.Services.EventBus",["ngResource"]).factory("EventBus",["$rootScope",function(e){var t=this,n={};t.emit=function(){var t=Array.prototype.slice.call(arguments,1);angular.forEach(n,function(n,r){angular.forEach(n,function(n){t.length?e.$emit(r,n(t)):e.$emit(r,n())})})},t.on=function(t,r){n[t]instanceof Array||(n[t]=[]),n[t].push(r),e.$on(n[t],r)},t.remove=function(e,t){var r=n[e],o=r instanceof Array?r.indexOf(t):-1;o>-1&&n[e].splice(o,1)},t.removeAll=function(e){e?n[e]=[]:n={}}}]),angular.module("CapeClient.Services.Interceptor",["ngResource"]).factory("Interceptor",["$q","$location",function(e){return function(t){return t.then(function(e){return e},function(t){return e.reject(t)})}}]),angular.module("CapeClient.Services.MD5",["ngResource"]).factory("MD5",function(){return function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,o,a,i;return o=2147483648&e,a=2147483648&t,n=1073741824&e,r=1073741824&t,i=(1073741823&e)+(1073741823&t),n&r?2147483648^i^o^a:n|r?1073741824&i?3221225472^i^o^a:1073741824^i^o^a:i^o^a}function r(e,t,n){return e&t|~e&n}function o(e,t,n){return e&n|t&~n}function a(e,t,n){return e^t^n}function i(e,t,n){return t^(e|~n)}function s(e,o,a,i,s,l,u){return e=n(e,n(n(r(o,a,i),s),u)),n(t(e,l),o)}function l(e,r,a,i,s,l,u){return e=n(e,n(n(o(r,a,i),s),u)),n(t(e,l),r)}function u(e,r,o,i,s,l,u){return e=n(e,n(n(a(r,o,i),s),u)),n(t(e,l),r)}function d(e,r,o,a,s,l,u){return e=n(e,n(n(i(r,o,a),s),u)),n(t(e,l),r)}function c(e){for(var t,n=e.length,r=n+8,o=(r-r%64)/64,a=16*(o+1),i=Array(a-1),s=0,l=0;n>l;)t=(l-l%4)/4,s=8*(l%4),i[t]=i[t]|e.charCodeAt(l)<<s,l++;return t=(l-l%4)/4,s=8*(l%4),i[t]=i[t]|128<<s,i[a-2]=n<<3,i[a-1]=n>>>29,i}function p(e){var t,n,r="",o="";for(n=0;3>=n;n++)t=255&e>>>8*n,o="0"+t.toString(16),r+=o.substr(o.length-2,2);return r}function g(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;e.length>n;n++){var r=e.charCodeAt(n);128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(192|r>>6),t+=String.fromCharCode(128|63&r)):(t+=String.fromCharCode(224|r>>12),t+=String.fromCharCode(128|63&r>>6),t+=String.fromCharCode(128|63&r))}return t}var m,f,h,v,w,b,y,S,k,C=[],$=7,T=12,M=17,D=22,E=5,P=9,A=14,x=20,N=4,R=11,j=16,G=23,I=6,O=10,B=15,L=21;for(e=g(e),C=c(e),b=1732584193,y=4023233417,S=2562383102,k=271733878,m=0;C.length>m;m+=16)f=b,h=y,v=S,w=k,b=s(b,y,S,k,C[m+0],$,3614090360),k=s(k,b,y,S,C[m+1],T,3905402710),S=s(S,k,b,y,C[m+2],M,606105819),y=s(y,S,k,b,C[m+3],D,3250441966),b=s(b,y,S,k,C[m+4],$,4118548399),k=s(k,b,y,S,C[m+5],T,1200080426),S=s(S,k,b,y,C[m+6],M,2821735955),y=s(y,S,k,b,C[m+7],D,4249261313),b=s(b,y,S,k,C[m+8],$,1770035416),k=s(k,b,y,S,C[m+9],T,2336552879),S=s(S,k,b,y,C[m+10],M,4294925233),y=s(y,S,k,b,C[m+11],D,2304563134),b=s(b,y,S,k,C[m+12],$,1804603682),k=s(k,b,y,S,C[m+13],T,4254626195),S=s(S,k,b,y,C[m+14],M,2792965006),y=s(y,S,k,b,C[m+15],D,1236535329),b=l(b,y,S,k,C[m+1],E,4129170786),k=l(k,b,y,S,C[m+6],P,3225465664),S=l(S,k,b,y,C[m+11],A,643717713),y=l(y,S,k,b,C[m+0],x,3921069994),b=l(b,y,S,k,C[m+5],E,3593408605),k=l(k,b,y,S,C[m+10],P,38016083),S=l(S,k,b,y,C[m+15],A,3634488961),y=l(y,S,k,b,C[m+4],x,3889429448),b=l(b,y,S,k,C[m+9],E,568446438),k=l(k,b,y,S,C[m+14],P,3275163606),S=l(S,k,b,y,C[m+3],A,4107603335),y=l(y,S,k,b,C[m+8],x,1163531501),b=l(b,y,S,k,C[m+13],E,2850285829),k=l(k,b,y,S,C[m+2],P,4243563512),S=l(S,k,b,y,C[m+7],A,1735328473),y=l(y,S,k,b,C[m+12],x,2368359562),b=u(b,y,S,k,C[m+5],N,4294588738),k=u(k,b,y,S,C[m+8],R,2272392833),S=u(S,k,b,y,C[m+11],j,1839030562),y=u(y,S,k,b,C[m+14],G,4259657740),b=u(b,y,S,k,C[m+1],N,2763975236),k=u(k,b,y,S,C[m+4],R,1272893353),S=u(S,k,b,y,C[m+7],j,4139469664),y=u(y,S,k,b,C[m+10],G,3200236656),b=u(b,y,S,k,C[m+13],N,681279174),k=u(k,b,y,S,C[m+0],R,3936430074),S=u(S,k,b,y,C[m+3],j,3572445317),y=u(y,S,k,b,C[m+6],G,76029189),b=u(b,y,S,k,C[m+9],N,3654602809),k=u(k,b,y,S,C[m+12],R,3873151461),S=u(S,k,b,y,C[m+15],j,530742520),y=u(y,S,k,b,C[m+2],G,3299628645),b=d(b,y,S,k,C[m+0],I,4096336452),k=d(k,b,y,S,C[m+7],O,1126891415),S=d(S,k,b,y,C[m+14],B,2878612391),y=d(y,S,k,b,C[m+5],L,4237533241),b=d(b,y,S,k,C[m+12],I,1700485571),k=d(k,b,y,S,C[m+3],O,2399980690),S=d(S,k,b,y,C[m+10],B,4293915773),y=d(y,S,k,b,C[m+1],L,2240044497),b=d(b,y,S,k,C[m+8],I,1873313359),k=d(k,b,y,S,C[m+15],O,4264355552),S=d(S,k,b,y,C[m+6],B,2734768916),y=d(y,S,k,b,C[m+13],L,1309151649),b=d(b,y,S,k,C[m+4],I,4149444226),k=d(k,b,y,S,C[m+11],O,3174756917),S=d(S,k,b,y,C[m+2],B,718787259),y=d(y,S,k,b,C[m+9],L,3951481745),b=n(b,f),y=n(y,h),S=n(S,v),k=n(k,w);var W=p(b)+p(y)+p(S)+p(k);return W.toLowerCase()}}),angular.module("CapeClient.Services.Storage",["ngResource"]).factory("Storage",["$rootScope","$config",function(e,t){"."!==t.title.substr(-1)&&(t.title=t.title?t.title+".":"");var n=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},r=function(e,r){if(!n())return!1;if(!r&&0!==r&&""!==r)return!1;try{localStorage.setItem(t.title+e,r)}catch(o){return!1}return!0},o=function(e){if(!n())return!1;var r=localStorage.getItem(t.title+e);return r?r:null},a=function(e){if(!n())return!1;try{localStorage.removeItem(t.title+e)}catch(r){return!1}return!0},i=function(){if(!n())return!1;var e=t.title.length;for(var r in localStorage)if(r.substr(0,e)===t.title)try{a(r.substr(e))}catch(o){return!1}return!0},s=function(){try{return"sessionStorage"in window&&null!==window.sessionStorage}catch(e){return!1}},l=function(e,n){if(!s())return!1;if(!n&&0!==n&&""!==n)return!1;try{sessionStorage.setItem(t.title+e,n)}catch(r){return!1}return!0},u=function(e){if(!s())return!1;var n=sessionStorage.getItem(t.title+e);return n?n:null},d=function(e){if(!s())return!1;try{sessionStorage.removeItem(t.title+e)}catch(n){return!1}return!0},c=function(){if(!s())return!1;var e=t.title.length;for(var n in sessionStorage)if(n.substr(0,e)===t.title)try{d(n.substr(e))}catch(r){return!1}return!0},p=function(){try{return navigator.cookieEnabled||"cookie"in document&&(document.cookie.length>0||(document.cookie="test").indexOf.call(document.cookie,"test")>-1)}catch(e){return!1}},g=function(e,n){if(n===void 0)return!1;if(!p())return!1;try{var r="",o=new Date;null===n&&(t.cookie.expiry=-1,n=""),0!==t.cookie.expiry&&(o.setTime(o.getTime()+1e3*60*60*t.cookie.expiry),r="; expires="+o.toGMTString()),document.cookie=t.title+e+"="+n+r+"; path="+t.cookie.path}catch(a){return!1}return!0},m=function(n){if(!p())return e.$broadcast("StorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var r=document.cookie.split(";"),o=0;r.length>o;o++){for(var a=r[o];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t.title+n+"="))return decodeURIComponent(a.substring(t.title.length+n.length+1,a.length))}return null},f=function(e){g(e,null)},h=function(){for(var e=null,n=t.title.length,r=document.cookie.split(";"),o=0;r.length>o;o++){for(e=r[o];" "==e.charAt(0);)e=e.substring(1,e.length);key=e.substring(n,e.indexOf("=")),f(key)}},v=function(e){var t=e?localStorage.key:localStorage;return(.0009765625*(3+16*t.length/8192)).toPrecision(2)+" MB"},w=function(){return angular.fromJson(o("periods"))},b=function(){return angular.fromJson(o("groups"))},y=function(){return angular.fromJson(o("members"))};return{isSupported:n,add:r,get:o,remove:a,clearAll:i,session:{add:l,get:u,remove:d,clearAll:c},cookie:{add:g,get:m,remove:f,clearAll:h},size:v,local:{periods:w,groups:b,members:y}}}]),angular.module("CapeClient.Services.Strings",["ngResource"]).factory("Strings",function(){return{truncate:function(e,t,n){var r=e.length>t,o=r?e.substr(0,t-1):e,o=n&&r?o.substr(0,o.lastIndexOf(" ")):o;return r?o+"..":o}}}),angular.module("CapeClient.Services.Announcer",["ngResource"]).factory("Announcer",function(){return{process:function(e){var t={"short":[],"long":[]},n=0;return angular.forEach(e,function(e){e.body&&((e.body.match(/Prio 1/)||e.body.match(/PRIO 1/))&&(e.body=e.body.replace("Prio 1 ",""),e.prio={1:!0,test:!1}),(e.body.match(/Prio 2/)||e.body.match(/PRIO 2/))&&(e.body=e.body.replace("Prio 2 ",""),e.prio={2:!0,test:!1}),(e.body.match(/Prio 3/)||e.body.match(/PRIO 3/))&&(e.body=e.body.replace("Prio 3 ",""),e.prio={3:!0,test:!1}),e.body.match(/PROEFALARM/)&&(e.prio={test:!0}),4>n&&t.short.push(e),t.long.push(e),n++)}),t}}}),angular.module("CapeClient.Services.Sloter",["ngResource"]).factory("Sloter",["$rootScope","Storage",function(e,t){return{get:{groups:function(){var e={};return angular.forEach(t.local.groups(),function(t){e[t.uuid]=t.name}),e},members:function(){var e={};return angular.forEach(t.local.members(),function(t){e[t.uuid]=t.name}),e}},wrapper:function(e){return'<span style="display:none;">'+e+"</span>"},secret:function(e){return'<span class="secret">'+e+"</span>"},addLoading:function(e,t,n){return angular.forEach(n,function(n){t.push({start:e.periods.end,end:15778368e5,group:n,content:"loading",className:"state-loading-right",editable:!1}),t.push({start:0,end:e.periods.start,group:n,content:"loading",className:"state-loading-left",editable:!1})}),t},user:function(n,r,o){var a=this,i=angular.fromJson(t.get("data")).user;return console.log("====> userdata ->",i),angular.forEach(i,function(t){angular.forEach(o.legenda,function(n,i){t.text==i&&n&&r.push({start:Math.round(1e3*t.start),end:Math.round(1e3*t.end),group:t.recursive?a.wrapper("b")+e.ui.planboard.weeklyPlanning+a.wrapper("recursive"):a.wrapper("a")+e.ui.planboard.planning+a.wrapper("planning"),content:a.secret(angular.toJson({type:"slot",id:t.id,recursive:t.recursive,state:t.text})),className:o.states[t.text].className,editable:!0})})}),r},profile:function(t,n){var r=this,o=[];return angular.forEach(t,function(t){angular.forEach(n.legenda,function(a,i){t.text==i&&a&&o.push({start:Math.round(1e3*t.start),end:Math.round(1e3*t.end),group:t.recursive?r.wrapper("b")+e.ui.planboard.weeklyPlanning+r.wrapper("recursive"):r.wrapper("a")+e.ui.planboard.planning+r.wrapper("planning"),content:r.secret(angular.toJson({type:"slot",id:t.id,recursive:t.recursive,state:t.text})),className:n.states[t.text].className,editable:!0})})}),o.push({start:0,end:1,group:r.wrapper("b")+e.ui.planboard.weeklyPlanning+r.wrapper("recursive"),content:"",className:null,editable:!1}),o.push({start:0,end:1,group:r.wrapper("a")+e.ui.planboard.planning+r.wrapper("planning"),content:"",className:null,editable:!1}),o},namer:function(e,t,n){var r,o=this.get.groups(),a=o[e.aggs.id],i='<a href="#/groups?uuid='+e.aggs.id+'#view">'+a+"</a>";if("all"==e.aggs.division||void 0==e.aggs.division)r=1==n?i:"<span>"+a+"</span>";else{var s;angular.forEach(t,function(t){t.id==e.aggs.division&&(s=t.label)}),r=1==n?i:"<span>"+a+"</span>",r+=' <span class="label">'+s+"</span>"}return r},bars:function(e,t,n,r){var o=this,a=0;return angular.forEach(e.aggs.data,function(e){e.wish>a&&(a=e.wish)}),angular.forEach(e.aggs.data,function(i){var s=a,l=i.wish,u=l,d=Math.round(80*(l/s)+20),c=d,p="height:"+d+"px;",g='<div class="requirement" style="'+p+'" '+'title="'+"Minimum aantal benodigden"+": "+l+' personen"></div>';l=i.wish+i.diff;var m=l;if(d=Math.round(80*(l/s)+20),i.diff>=0&&7>i.diff)switch(i.diff){case 0:var f=n.densities.even;break;case 1:var f=n.densities.one;break;case 2:var f=n.densities.two;break;case 3:var f=n.densities.three;break;case 4:var f=n.densities.four;break;case 5:var f=n.densities.five;break;case 6:var f=n.densities.six}else if(i.diff>=7)var f=n.densities.more;else var f=n.densities.less;var h='<span class="badge badge-inverse">'+i.diff+"</span>";m>u&&(d=c),p="height:"+d+"px;"+"background-color: "+f+";";var v='<div class="bar" style="'+p+'" '+' title="Huidig aantal beschikbaar: '+l+' personen">'+h+"</div>";(i.diff>0&&n.legenda.groups.more||0==i.diff&&n.legenda.groups.even||0>i.diff&&n.legenda.groups.less)&&t.push({start:Math.round(1e3*i.start),end:Math.round(1e3*i.end),group:o.wrapper("c")+r,content:g+v+o.secret(angular.toJson({type:"group",diff:i.diff,group:r})),className:"group-aggs",editable:!1}),t=o.addLoading(e,t,[o.wrapper("c")+r])}),t},aggs:function(e,t,n,r){var o=this;return angular.forEach(e.aggs.data,function(a){var i;if(a.diff>=0&&7>a.diff)switch(a.diff){case 0:i="even";break;case 1:i=1;break;case 2:i=2;break;case 3:i=3;break;case 4:i=4;break;case 5:i=5;break;case 6:i=6}else i=a.diff>=7?"more":"less";(a.diff>0&&n.legenda.groups.more||0==a.diff&&n.legenda.groups.even||0>a.diff&&n.legenda.groups.less)&&t.push({start:Math.round(1e3*a.start),end:Math.round(1e3*a.end),group:o.wrapper("c")+r,content:i+o.secret(angular.toJson({type:"group",diff:a.diff,group:r})),className:"agg-"+i,editable:!1}),t=o.addLoading(e,t,[o.wrapper("c")+r])}),t},wishes:function(e,t,n){var r=this;return angular.forEach(e.aggs.wishes,function(o){if(o.count>=7)var a="wishes-more";else if(0==o.count)var a="wishes-even";else var a="wishes-"+o.count;t.push({start:Math.round(1e3*o.start),end:Math.round(1e3*o.end),group:r.wrapper("c")+n+" (Wishes)",content:'<span class="badge badge-inverse">'+o.count+"</span>"+r.secret(angular.toJson({type:"wish",wish:o.count,group:n,groupId:e.aggs.id})),className:a,editable:!1}),t=r.addLoading(e,t,[r.wrapper("c")+n+" (Wishes)"])}),t},members:function(e,t,n,r){var o=this,a=this.get.members();return angular.forEach(e.members,function(i){var s=1==r?o.wrapper("d")+'<a href="#/profile/'+i.id+'#timeline">'+a[i.id]+"</a>":o.wrapper("d")+a[i.id];angular.forEach(i.data,function(e){angular.forEach(n.legenda,function(r,a){e.text==a&&r&&t.push({start:Math.round(1e3*e.start),end:Math.round(1e3*e.end),group:s,content:o.secret(angular.toJson({type:"member",id:e.id,mid:i.id,recursive:e.recursive,state:e.text})),className:n.states[e.text].className,editable:!1})})}),t.push({start:0,end:0,group:s,content:null,className:null,editable:!1}),t=o.addLoading(e,t,[s]),angular.forEach(i.stats,function(e){var t=e.state.split(".");t.reverse(),e.state="bar-"+t[0]})}),t},pies:function(e){document.getElementById("groupPie").innerHTML="";var t=[],n={more:"#415e6b",even:"#ba6a24",less:"#a0a0a0"},r=[],o=[];angular.forEach(e.aggs.ratios,function(e,r){0!=e&&t.push({ratio:e,color:n[r]})}),t=t.sort(function(e,t){return t.ratio-e.ratio}),angular.forEach(t,function(e){r.push(e.color),o.push(e.ratio)});var a=Raphael("groupPie");a.piechart(120,120,100,o,{colors:r})},process:function(e,t){var n=this,r=[];return r=n.user(e,r,t)}}}]),angular.module("CapeClient.Services.Stats",["ngResource"]).factory("Stats",["$rootScope","Storage",function(){return{aggs:function(e){var t={less:0,even:0,more:0},n={less:0,even:0,more:0,total:0},r=e.length;return angular.forEach(e,function(e){0>e.diff?t.less++:0==e.diff?t.even++:t.more++;var r=e.end-e.start;0>e.diff?n.less=n.less+r:0==e.diff?n.even=n.even+r:n.more=n.more+r,n.total=n.total+r}),{ratios:{less:Math.round(100*(t.less/r)),even:Math.round(100*(t.even/r)),more:Math.round(100*(t.more/r))},durations:n}},pies:function(e){var t={less:0,even:0,more:0},n=e.length;return angular.forEach(e,function(e){0>e.diff?t.less++:0==e.diff?t.even++:t.more++}),{less:Math.round(100*(t.less/n)),even:Math.round(100*(t.even/n)),more:Math.round(100*(t.more/n))}},member:function(e){var t={},n=0;angular.forEach(e,function(e){t[e.text]?t[e.text]++:t[e.text]=1,n++});var r=[];return angular.forEach(t,function(e,t){r.push({state:t,ratio:100*(e/n)})}),r}}}]),angular.module("CapeClient.Filters",[]).filter("translateRole",["$config",function(e){return function(t){var n;return angular.forEach(e.roles,function(e){e.id==t&&(n=e.label)}),n}}]).filter("rangeMainFilter",["Dater","Storage",function(e){var t=e.getPeriods();return function(n){86401e3==new Date(n.end).getTime()-new Date(n.start).getTime()&&(n.start=new Date(n.end).addDays(-1));var n={start:{real:new Date(n.start).toString("dddd, MMMM d"),month:new Date(n.start).toString("MMMM"),day:new Date(n.start).toString("d")},end:{real:new Date(n.end).toString("dddd, MMMM d"),month:new Date(n.end).toString("MMMM"),day:new Date(n.end).toString("d")}},r=Date.getMonthNumberFromName(n.start.month);return(Math.round(n.start.day)+1==n.end.day&&n.start.hour==n.end.hour||n.start.day==n.end.day)&&n.start.month==n.end.month?n.start.real+", "+e.getThisYear():1==n.start.day&&n.end.day==t.months[r+1].totalDays?n.start.month+", "+e.getThisYear():n.start.real+" / "+n.end.real+", "+e.getThisYear()}}]).filter("rangeMainWeekFilter",["Dater","Storage",function(e){return e.getPeriods(),function(t){if(t){var t={start:new Date(t.start).toString("dddd, MMMM d"),end:new Date(t.end).toString("dddd, MMMM d")};return t.start+" / "+t.end+", "+e.getThisYear()}}}]).filter("rangeInfoFilter",["Dater","Storage",function(e){var t=e.getPeriods();return function(e){var n=new Date(e.range.end).getTime()-new Date(e.range.start).getTime();if(n>26784e5)return"Total selected days: "+Math.round(n/864e5);if(e.scope.day){var r={start:new Date(e.range.start).toString("HH:mm"),end:new Date(e.range.end).toString("HH:mm")};return"00:00"==r.end&&(r.end="24:00"),"Time: "+r.start+" / "+r.end}return e.scope.week?"Week number: "+e.current.week:e.scope.month?"Month number: "+e.current.month+", Total days: "+t.months[e.current.month].totalDays:void 0}}]).filter("rangeInfoWeekFilter",["Dater","Storage",function(e){return e.getPeriods(),function(e){return e?"Week number: "+e.current.week:void 0}}]).filter("convertRatios",["$config",function(){return function(e){var t="";return angular.forEach(e,function(e){t+=e.ratio.toFixed(1)+"% "+e.state.replace(/^bar-+/,"")+", "}),t.substring(0,t.length-2)}}]).filter("calculateTimeInDays",function(){return function(e){var t=864e5,n=0,r=0,e=1e3*e,r=e%t,n=e-r;return Math.floor(n/t)}}).filter("calculateTimeInHours",function(){return function(e){var t=864e5,n=36e5,r=0,e=1e3*e,r=e%t;return Math.floor(r/n)}}).filter("calculateTimeInMinutes",function(){return function(e){var t=36e5,n=6e4,r=0,e=1e3*e,r=e%t;return Math.floor(r/n)}}).filter("convertEve",function(){return function(e){var t=e;return t=e!==void 0?e.split("/"):["",e,""],t[t.length-2]}}).filter("convertUserIdToName",["Storage",function(e){var t=angular.fromJson(e.get("members"));return function(e){return null==t||t[e]===void 0?e:t[e].name}}]).filter("nicelyDate",["$rootScope",function(e){return function(t){return"string"==typeof t&&(t=Number(t)),new Date(t).toString(e.config.formats.datetime)}}]).filter("convertTimeStamp",function(){return function(e){return console.warn(typeof e),new Date(e).toString("dd-MM-yyyy HH:mm")}}).filter("noTitle",function(){return function(e){return""==e?"- No Title -":e}}).filter("stripSpan",function(){return function(e){return e.match(/<span class="label">(.*)<\/span>/)}}).filter("stripHtml",function(){return function(e){return e?e.split(">")[1].split("<")[0]:void 0}}).filter("groupIdToName",["Storage",function(e){return function(t){var n=angular.fromJson(e.get("groups"));for(var r in n)if(n[r].uuid==t)return n[r].name}}]).filter("i18n_spec",["$rootScope",function(e){return function(t,n){var r=n.split("."),o=e.ui[r[0]][r[1]],o=o.replace("$v",t);return o}}]).filter("truncateGroupTitle",["Strings",function(e){return function(t){return e.truncate(t,20,!0)}}]).filter("countBox",function(){return function(e){var t=0;return angular.forEach(e,function(e){t+=e.length}),t}});